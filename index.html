<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <link rel="icon" href="/favicon.ico" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="CrediFácil - O seu guia definitivo para sair das dívidas, conseguir cartões de crédito e empréstimos com as melhores taxas.">
    <meta name="keywords" content="empréstimo, cartão de crédito, nome sujo, score, finanças, limpar nome, educação financeira">
    <meta name="author" content="CrediFácil">
    <meta name="robots" content="index, follow">
      
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1017585624443150" crossorigin="anonymous"></script>

    <!-- FIREBASE SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <!-- Chart.js para Dashboard 2.0 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <title>CrediFácil | Guia de Crédito e Finanças Pessoais</title>
     
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
     
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Merriweather:ital,wght@0,300;0,400;0,700;1,300&display=swap" rel="stylesheet">
     
    <!-- Ícones -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Merriweather', 'serif'],
                    },
                    colors: {
                        brand: {
                            50: '#FEFCE8', 100: '#FEF9C3', 400: '#FACC15', 500: '#EAB308', 600: '#CA8A04', 900: '#713F12',
                        },
                        navy: { 800: '#18181b', 900: '#000000' }
                    },
                    transitionProperty: {
                        'width': 'width',
                        'spacing': 'margin, padding',
                    }
                }
            }
        }
    </script>

    <style>
        body { -webkit-font-smoothing: antialiased; }
        
        /* Animações */
        .fade-in { animation: fadeIn 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .animate-pulse-custom { animation: pulse-custom 0.3s ease-in-out; }
        @keyframes pulse-custom { 0% { transform: scale(1); } 50% { transform: scale(1.3) rotate(-10deg); } 100% { transform: scale(1); } }

        /* Toast Animation */
        .toast-enter { transform: translateX(100%); opacity: 0; }
        .toast-enter-active { transform: translateX(0); opacity: 1; transition: all 0.3s ease-out; }
        .toast-exit { transform: translateX(0); opacity: 1; }
        .toast-exit-active { transform: translateX(100%); opacity: 0; transition: all 0.3s ease-in; }

        .hidden-section { display: none !important; }
        .page-wrapper { display: flex; flex-direction: column; min-height: 100vh; }
        main { flex: 1; }
        
        /* Modal e Overlays */
        .modal-overlay { background-color: rgba(0, 0, 0, 0.5); backdrop-filter: blur(4px); }

        /* Barra de Progresso de Leitura */
        #reading-progress-container { position: fixed; top: 0; left: 0; width: 100%; height: 4px; background: transparent; z-index: 9999; display: none; }
        #reading-progress-bar { height: 100%; background: #FACC15; width: 0%; transition: width 0.1s; }

        /* Botões Flutuantes (WhatsApp & BackTop) */
        .floating-btn { position: fixed; right: 20px; z-index: 90; transition: all 0.3s; }
        #whatsapp-btn { bottom: 20px; }
        #back-top-btn { bottom: 90px; opacity: 0; visibility: hidden; }
        #back-top-btn.visible { opacity: 1; visibility: visible; }

        /* Ad Slot */
        .ad-slot { 
            display: block; margin: 2rem auto; background-color: #f3f4f6; 
            min-height: 90px; width: 100%; text-align: center; overflow: hidden; 
            border-radius: 8px; display: flex; align-items: center; justify-content: center;
        }
        .ad-slot::before { content: 'Publicidade'; color: #9ca3af; font-size: 0.75rem; font-weight: 600; letter-spacing: 0.05em; text-transform: uppercase; }

        .input-simulator:focus { border-color: #FACC15; box-shadow: 0 0 0 3px rgba(250, 204, 21, 0.3); }

        /* --- EDITOR RICO & CONTEÚDO --- */
        .rich-editor-toolbar {
            border-bottom: 1px solid #e5e7eb; padding: 10px; background: #f9fafb;
            border-radius: 8px 8px 0 0; display: flex; gap: 6px; flex-wrap: wrap;
        }
        .rich-editor-btn {
            background: white; border: 1px solid #d1d5db; padding: 6px 10px;
            border-radius: 6px; cursor: pointer; font-size: 14px; color: #374151; font-weight: 600; transition: all 0.2s;
        }
        .rich-editor-btn:hover { background: #e5e7eb; color: #000; transform: translateY(-1px); }
        
        .rich-editor-content, .rich-content { font-family: 'Merriweather', serif; color: #374151; line-height: 1.8; }
        .rich-editor-content {
            min-height: 350px; padding: 20px; border: 1px solid #d1d5db; border-top: none;
            border-radius: 0 0 8px 8px; outline: none; background: white; overflow-y: auto;
        }
        .rich-editor-content:focus { border-color: #FACC15; box-shadow: 0 0 0 3px rgba(250, 204, 21, 0.1); }
        
        /* Tipografia Rica */
        .rich-content h1, .rich-editor-content h1 { font-family: 'Inter', sans-serif; font-size: 2.25em; font-weight: 800; margin: 1.5em 0 0.5em; color: #111; line-height: 1.2; }
        .rich-content h2, .rich-editor-content h2 { font-family: 'Inter', sans-serif; font-size: 1.75em; font-weight: 700; margin: 1.5em 0 0.5em; color: #1f2937; border-left: 4px solid #FACC15; padding-left: 1rem; }
        .rich-content h3, .rich-editor-content h3 { font-family: 'Inter', sans-serif; font-size: 1.4em; font-weight: 600; margin: 1.25em 0 0.5em; color: #374151; }
        .rich-content p, .rich-editor-content p { margin-bottom: 1.25em; font-size: 1.1rem; }
        .rich-content ul, .rich-editor-content ul { list-style-type: disc !important; padding-left: 1.5em !important; margin-bottom: 1.25em; }
        .rich-content ol, .rich-editor-content ol { list-style-type: decimal !important; padding-left: 1.5em !important; margin-bottom: 1.25em; }
        .rich-content blockquote, .rich-editor-content blockquote { border-left: 4px solid #FACC15; padding: 1.5rem; margin: 1.5em 0; background: #fffbeb; font-style: italic; color: #4b5563; border-radius: 0 8px 8px 0; }
        .rich-content img, .rich-editor-content img { max-width: 100%; height: auto; border-radius: 12px; margin: 2em 0; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        
        /* Admin Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* Admin Sidebar Logic */
        .sidebar-expanded { width: 16rem; }
        .sidebar-collapsed { width: 5rem; }
        .content-expanded { margin-left: 16rem; }
        .content-collapsed { margin-left: 5rem; }
        .hide-text .nav-text { display: none; }
        .hide-text .logo-text { display: none; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 page-wrapper">

    <!-- Reading Progress Bar -->
    <div id="reading-progress-container"><div id="reading-progress-bar"></div></div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed top-5 right-5 z-[100] flex flex-col gap-2 pointer-events-none"></div>

    <!-- NOVIDADE 1: Botões Flutuantes (WhatsApp & Back Top) -->
    <a href="https://wa.me/5511999999999" target="_blank" id="whatsapp-btn" class="floating-btn bg-[#25D366] hover:bg-[#20bd5a] text-white p-4 rounded-full shadow-lg flex items-center justify-center transform hover:scale-110">
        <i class="ph-fill ph-whatsapp-logo text-3xl"></i>
    </a>
    <button onclick="window.scrollTo({top: 0, behavior: 'smooth'})" id="back-top-btn" class="floating-btn bg-black hover:bg-gray-800 text-white p-3 rounded-full shadow-lg flex items-center justify-center transform hover:scale-110">
        <i class="ph-bold ph-arrow-up text-xl"></i>
    </button>

    <!-- HEADER -->
    <header class="bg-black shadow-lg sticky top-0 z-50 border-b border-gray-800">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <!-- Logo -->
                <a href="#home" class="flex-shrink-0 group">
                    <div class="flex items-center gap-2">
                        <div class="bg-brand-400 text-black p-2 rounded-lg group-hover:bg-brand-500 transition"><i class="ph-fill ph-coins text-2xl"></i></div>
                        <span class="font-bold text-2xl text-white tracking-tight">Credi<span class="text-brand-400">Fácil</span></span>
                    </div>
                </a>
                
                <!-- Desktop Nav -->
                <nav class="hidden md:flex space-x-8">
                    <a href="#home" class="nav-link text-gray-300 hover:text-brand-400 font-medium transition text-sm uppercase tracking-wide">Início</a>
                    <a href="#emprestimo" class="nav-link text-gray-300 hover:text-brand-400 font-medium transition text-sm uppercase tracking-wide">Empréstimos</a>
                    <a href="#cartoes" class="nav-link text-gray-300 hover:text-brand-400 font-medium transition text-sm uppercase tracking-wide">Cartões</a>
                    <a href="#blog" class="nav-link text-gray-300 hover:text-brand-400 font-medium transition text-sm uppercase tracking-wide">Blog</a>
                    <a href="#sobre" class="nav-link text-gray-300 hover:text-brand-400 font-medium transition text-sm uppercase tracking-wide">Sobre</a>
                </nav>
                
                <!-- CTA Button -->
                <div class="hidden md:flex items-center gap-4">
                     <a href="#admin" class="text-gray-500 hover:text-white transition" title="Área Admin"><i class="ph-fill ph-lock-key text-xl"></i></a>
                    <a href="#emprestimo" class="bg-brand-400 hover:bg-brand-500 text-black px-6 py-2.5 rounded-full font-bold transition shadow-lg flex items-center gap-2 transform hover:-translate-y-0.5">
                        <span>Simular Agora</span><i class="ph-bold ph-lightning"></i>
                    </a>
                </div>
                
                <!-- Mobile Menu Button -->
                <div class="md:hidden">
                    <button onclick="toggleMobileMenu()" class="text-white hover:text-brand-400 p-2"><i class="ph ph-list text-3xl"></i></button>
                </div>
            </div>
        </div>
        
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-zinc-900 border-t border-gray-800 absolute w-full left-0 shadow-2xl">
            <div class="px-4 pt-2 pb-6 space-y-2">
                <a href="#home" onclick="toggleMobileMenu()" class="block px-3 py-3 text-base font-medium text-gray-300 hover:bg-black hover:text-brand-400 rounded-md">Início</a>
                <a href="#emprestimo" onclick="toggleMobileMenu()" class="block px-3 py-3 text-base font-medium text-gray-300 hover:bg-black hover:text-brand-400 rounded-md">Simulador</a>
                <a href="#cartoes" onclick="toggleMobileMenu()" class="block px-3 py-3 text-base font-medium text-gray-300 hover:bg-black hover:text-brand-400 rounded-md">Cartões</a>
                <a href="#blog" onclick="toggleMobileMenu()" class="block px-3 py-3 text-base font-medium text-gray-300 hover:bg-black hover:text-brand-400 rounded-md">Blog</a>
                <a href="#sobre" onclick="toggleMobileMenu()" class="block px-3 py-3 text-base font-medium text-gray-300 hover:bg-black hover:text-brand-400 rounded-md">Sobre</a>
                <a href="#admin" onclick="toggleMobileMenu()" class="block px-3 py-3 text-base font-medium text-brand-400 font-bold hover:bg-black rounded-md">Área Admin</a>
            </div>
        </div>
    </header>

    <main id="app-content" class="relative">
        
        <!-- ================= HOME ================= -->
        <section id="home" class="page-section fade-in">
            <!-- Hero Section -->
            <div class="bg-black text-white relative overflow-hidden border-b border-gray-800">
                <div class="absolute top-0 right-0 w-2/3 h-full bg-gradient-to-l from-brand-900/20 to-transparent pointer-events-none"></div>
                <div class="container mx-auto px-4 py-20 lg:py-32 relative z-10">
                    <div class="max-w-4xl mx-auto text-center">
                        <span class="bg-brand-400/10 text-brand-400 px-4 py-1.5 rounded-full text-sm font-bold tracking-wider uppercase mb-8 inline-block border border-brand-400/20">Liberdade Financeira ao seu alcance</span>
                        <h1 class="text-4xl md:text-6xl lg:text-7xl font-extrabold leading-tight mb-8">Saia do vermelho e recupere o seu <span class="text-brand-400 inline-block transform hover:scale-105 transition cursor-default">Crédito</span>.</h1>
                        <p class="text-lg md:text-xl text-gray-400 mb-10 max-w-2xl mx-auto leading-relaxed">
                            Acesse nosso comparador de cartões para negativados, simule empréstimos com taxas justas e aprenda a investir com nosso conteúdo educativo.
                        </p>
                        <div class="flex flex-col sm:flex-row gap-4 justify-center">
                            <a href="#blog" class="bg-brand-400 hover:bg-brand-500 text-black px-8 py-4 rounded-xl font-bold text-lg transition shadow-[0_0_20px_rgba(250,204,21,0.3)] hover:shadow-[0_0_30px_rgba(250,204,21,0.5)]">Ler Artigos</a>
                            <a href="#cartoes" class="bg-white/5 hover:bg-white/10 backdrop-blur-md text-white border border-white/20 px-8 py-4 rounded-xl font-bold text-lg transition flex items-center justify-center gap-2">Buscar Cartão <i class="ph-bold ph-credit-card"></i></a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- NOVIDADE 2: Widget Saúde Financeira -->
            <div class="container mx-auto px-4 py-12">
                <div class="bg-white rounded-3xl p-8 shadow-xl border border-gray-100 max-w-3xl mx-auto -mt-24 relative z-20">
                    <h3 class="text-2xl font-bold text-center mb-6 text-black flex items-center justify-center gap-2"><i class="ph-fill ph-heartbeat text-red-500"></i> Calculadora de Saúde Financeira</h3>
                    <div class="grid md:grid-cols-3 gap-6 items-end">
                        <div>
                            <label class="block text-xs font-bold uppercase text-gray-500 mb-2">Renda Mensal</label>
                            <input type="number" id="health-income" placeholder="Ex: 3000" class="w-full p-3 border border-gray-200 rounded-xl focus:border-brand-400 outline-none transition">
                        </div>
                        <div>
                            <label class="block text-xs font-bold uppercase text-gray-500 mb-2">Gastos Mensais</label>
                            <input type="number" id="health-expenses" placeholder="Ex: 2500" class="w-full p-3 border border-gray-200 rounded-xl focus:border-brand-400 outline-none transition">
                        </div>
                        <button onclick="calcFinancialHealth()" class="w-full bg-black text-white font-bold p-3 rounded-xl hover:bg-brand-500 hover:text-black transition">Calcular</button>
                    </div>
                    <div id="health-result" class="hidden mt-6 p-4 rounded-xl text-center bg-gray-50 border border-gray-200">
                        <span id="health-icon" class="text-3xl block mb-2"></span>
                        <h4 id="health-status" class="font-bold text-lg"></h4>
                        <p id="health-message" class="text-sm text-gray-600 mt-1"></p>
                    </div>
                </div>
            </div>
            
            <div class="container mx-auto px-4 -mt-8 relative z-20">
                <div class="ad-slot shadow-lg bg-white rounded-lg border border-gray-200">
                    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-1017585624443150" data-ad-slot="1234567890" data-ad-format="auto" data-full-width-responsive="true"></ins>
                </div>
            </div>

            <div class="container mx-auto px-4 py-24">
                <div class="grid md:grid-cols-3 gap-8">
                    <a href="#cartoes" class="bg-white p-8 rounded-2xl shadow-sm hover:shadow-xl transition border border-gray-100 group flex flex-col items-center text-center">
                        <div class="bg-gray-900 w-16 h-16 rounded-2xl flex items-center justify-center text-brand-400 mb-6 group-hover:scale-110 group-hover:rotate-3 transition duration-300 shadow-lg"><i class="ph-fill ph-cards text-3xl"></i></div>
                        <h3 class="text-2xl font-bold text-black mb-3">Cartões Aprovados</h3>
                        <p class="text-gray-600 leading-relaxed">Ranking atualizado de cartões que aprovam negativados e oferecem limites iniciais altos.</p>
                    </a>
                    <a href="#emprestimo" class="bg-white p-8 rounded-2xl shadow-sm hover:shadow-xl transition border border-gray-100 group flex flex-col items-center text-center">
                        <div class="bg-brand-50 w-16 h-16 rounded-2xl flex items-center justify-center text-brand-600 mb-6 group-hover:scale-110 group-hover:-rotate-3 transition duration-300 shadow-lg"><i class="ph-fill ph-calculator text-3xl"></i></div>
                        <h3 class="text-2xl font-bold text-black mb-3">Simulador Rápido</h3>
                        <p class="text-gray-600 leading-relaxed">Calcule parcelas reais. Saiba exatamente quanto vai pagar antes de contratar qualquer crédito.</p>
                    </a>
                    <a href="#blog" class="bg-white p-8 rounded-2xl shadow-sm hover:shadow-xl transition border border-gray-100 group flex flex-col items-center text-center">
                        <div class="bg-gray-100 w-16 h-16 rounded-2xl flex items-center justify-center text-gray-700 mb-6 group-hover:scale-110 transition duration-300 shadow-lg"><i class="ph-fill ph-trend-up text-3xl"></i></div>
                        <h3 class="text-2xl font-bold text-black mb-3">Aumente seu Score</h3>
                        <p class="text-gray-600 leading-relaxed">Estratégias comprovadas para subir sua pontuação no Serasa e Boa Vista em tempo recorde.</p>
                    </a>
                </div>
            </div>

            <!-- Home Blog Feed -->
            <div class="bg-gray-50 py-24 border-t border-gray-200">
                <div class="container mx-auto px-4">
                    <div class="flex flex-col md:flex-row justify-between items-end mb-12 gap-4">
                        <div>
                            <span class="text-brand-600 font-bold uppercase tracking-wider text-sm">Blog & Notícias</span>
                            <h2 class="text-3xl md:text-4xl font-bold text-black mt-2">Últimas Atualizações</h2>
                        </div>
                        <a href="#blog" class="px-6 py-3 bg-white border border-gray-300 hover:border-black rounded-full text-black font-semibold transition flex items-center gap-2 group">
                            Ver todos os artigos <i class="ph-bold ph-arrow-right group-hover:translate-x-1 transition"></i>
                        </a>
                    </div>
                    <!-- Grid limitado a 4 posts -->
                    <div id="home-blog-grid" class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <!-- Carregado via JS -->
                        <div class="col-span-full text-center py-12"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-brand-500 mx-auto"></div></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ================= EMPRÉSTIMOS ================= -->
        <section id="emprestimo" class="page-section hidden-section fade-in">
             <!-- Conteúdo mantido igual ao original, resumido aqui para focar nas mudanças -->
             <div class="bg-black text-white py-20 relative overflow-hidden">
                <div class="absolute inset-0 bg-brand-600/10"></div>
                <div class="container mx-auto px-4 text-center relative z-10">
                    <h1 class="text-4xl md:text-5xl font-bold mb-6">Simulador de Empréstimo</h1>
                    <p class="text-gray-400 max-w-2xl mx-auto text-lg">Compare taxas, prazos e encontre a parcela que cabe no seu bolso.</p>
                </div>
            </div>
            
            <div class="container mx-auto px-4 py-16">
                <div class="grid lg:grid-cols-12 gap-12 items-start">
                    <!-- Coluna Principal (Formulário) -->
                    <div class="lg:col-span-7 bg-white p-8 md:p-10 rounded-3xl shadow-xl border border-gray-100 relative overflow-hidden">
                         <div class="absolute top-0 left-0 w-full h-2 bg-brand-400"></div>
                        <div class="flex items-center gap-3 mb-8">
                            <div class="bg-brand-100 p-3 rounded-xl text-brand-600"><i class="ph-fill ph-calculator text-2xl"></i></div>
                            <h3 class="text-2xl font-bold text-black">Faça sua Simulação</h3>
                        </div>
                        
                        <form id="loan-form" onsubmit="calculateFinalLoan(event)" class="space-y-8">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-3 uppercase tracking-wide">Valor Desejado (R$)</label>
                                <div class="relative">
                                    <span class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 font-bold">R$</span>
                                    <input type="number" id="loan-amount" oninput="updateLiveCalculation()" class="input-simulator w-full pl-12 pr-4 py-4 border border-gray-300 rounded-xl focus:outline-none transition text-xl font-bold text-black placeholder-gray-300" placeholder="5.000,00" min="500" step="100" required>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-3 uppercase tracking-wide">Prazo de Pagamento</label>
                                    <select id="loan-term" onchange="updateLiveCalculation()" class="input-simulator w-full px-4 py-4 border border-gray-300 rounded-xl focus:outline-none bg-white text-black font-medium text-lg cursor-pointer">
                                        <option value="12">12 meses</option>
                                        <option value="24">24 meses</option>
                                        <option value="36">36 meses</option>
                                        <option value="48">48 meses</option>
                                        <option value="60">60 meses</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-3 uppercase tracking-wide">CPF (Apenas números)</label>
                                    <input type="text" id="loan-cpf" class="input-simulator w-full px-4 py-4 border border-gray-300 rounded-xl focus:outline-none text-lg" placeholder="000.000.000-00">
                                </div>
                            </div>

                            <!-- Live Preview Box -->
                            <div id="live-preview" class="bg-gray-50 p-6 rounded-2xl border border-gray-200 hidden transition-all duration-300">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-500 font-medium">Estimativa Mensal:</span>
                                    <div class="text-right">
                                        <span class="text-3xl font-bold text-brand-600 block" id="live-installment">R$ 0,00</span>
                                        <span class="text-xs text-gray-400">Taxa estimada de 3.5% a.m.</span>
                                    </div>
                                </div>
                            </div>

                            <button type="submit" class="w-full bg-black hover:bg-gray-800 text-white font-bold py-5 rounded-xl transition transform hover:-translate-y-1 shadow-lg flex items-center justify-center gap-3 text-lg">
                                Buscar Ofertas <i class="ph-bold ph-magnifying-glass"></i>
                            </button>
                        </form>
                        
                        <!-- Resultado da Simulação -->
                        <div id="loan-result" class="hidden mt-10 pt-10 border-t border-gray-100 animate-fade-in">
                            <div class="bg-green-50 border border-green-200 rounded-2xl p-6 mb-6">
                                <div class="flex items-start gap-4">
                                    <div class="bg-green-100 p-2 rounded-full text-green-700 mt-1"><i class="ph-fill ph-check-circle text-xl"></i></div>
                                    <div>
                                        <h4 class="font-bold text-green-900 text-lg">Pré-aprovação Encontrada!</h4>
                                        <p class="text-green-800 text-sm mt-1">Baseado no seu perfil, selecionamos os parceiros abaixo.</p>
                                    </div>
                                </div>
                            </div>
                            <div id="loan-recommendations-container" class="space-y-4">
                                <!-- Cards inseridos via JS -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sidebar Informativa -->
                    <div class="lg:col-span-5 space-y-8">
                        <div class="bg-gray-50 p-8 rounded-3xl border border-gray-200">
                            <h3 class="text-xl font-bold text-black mb-6">Por que simular conosco?</h3>
                            <ul class="space-y-6">
                                <li class="flex gap-4">
                                    <div class="bg-white p-2 rounded-lg shadow-sm h-10 w-10 flex items-center justify-center text-brand-600"><i class="ph-fill ph-shield-check text-xl"></i></div>
                                    <div><h4 class="font-bold text-gray-900">Segurança Total</h4><p class="text-sm text-gray-600 mt-1">Seus dados são criptografados.</p></div>
                                </li>
                                <li class="flex gap-4">
                                    <div class="bg-white p-2 rounded-lg shadow-sm h-10 w-10 flex items-center justify-center text-brand-600"><i class="ph-fill ph-percent text-xl"></i></div>
                                    <div><h4 class="font-bold text-gray-900">Juros Competitivos</h4><p class="text-sm text-gray-600 mt-1">Buscamos as taxas mais baixas.</p></div>
                                </li>
                            </ul>
                        </div>

                        <!-- NOVIDADE 3: Histórico Recente -->
                        <div id="loan-history-widget" class="bg-white p-6 rounded-2xl border border-gray-200 shadow-sm hidden">
                            <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2"><i class="ph-fill ph-clock-counter-clockwise text-gray-400"></i> Histórico Recente</h4>
                            <div id="loan-history-list" class="space-y-3"></div>
                        </div>

                        <div class="ad-slot bg-white rounded-2xl shadow-sm border border-gray-100"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-1017585624443150" data-ad-slot="1234567890" data-ad-format="auto" data-full-width-responsive="true"></ins></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ================= CARTOES ================= -->
        <section id="cartoes" class="page-section hidden-section fade-in">
             <!-- Conteúdo mantido similar ao original -->
            <div class="bg-gray-50 border-b border-gray-200 py-16">
                <div class="container mx-auto px-4 text-center">
                    <h1 class="text-4xl font-bold text-black mb-4">Escolha seu Cartão Ideal</h1>
                    <p class="text-gray-600 max-w-2xl mx-auto text-lg">Use nossos filtros inteligentes para encontrar o cartão que aprova o seu perfil.</p>
                </div>
            </div>
            
            <div class="container mx-auto px-4 py-12">
                <!-- Filtros -->
                <div class="flex flex-wrap gap-3 justify-center mb-16">
                    <button onclick="filterCards('todos')" id="btn-todos" class="filter-btn active px-6 py-3 bg-black text-white rounded-xl text-sm font-bold transition shadow-lg transform hover:-translate-y-0.5">Todos</button>
                    <button onclick="filterCards('anuidade')" id="btn-anuidade" class="filter-btn px-6 py-3 bg-white border border-gray-200 text-gray-600 hover:border-brand-400 hover:text-black rounded-xl text-sm font-bold transition shadow-sm hover:shadow-md">Sem Anuidade</button>
                    <button onclick="filterCards('negativados')" id="btn-negativados" class="filter-btn px-6 py-3 bg-white border border-gray-200 text-gray-600 hover:border-brand-400 hover:text-black rounded-xl text-sm font-bold transition shadow-sm hover:shadow-md">Para Negativados</button>
                    <button onclick="filterCards('milhas')" id="btn-milhas" class="filter-btn px-6 py-3 bg-white border border-gray-200 text-gray-600 hover:border-brand-400 hover:text-black rounded-xl text-sm font-bold transition shadow-sm hover:shadow-md">Milhas e Cashback</button>
                </div>

                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8" id="cards-container">
                    <!-- Cards via JS -->
                </div>
            </div>
        </section>

        <!-- ================= BLOG (Melhorado) ================= -->
        <section id="blog" class="page-section hidden-section fade-in">
            <div class="bg-white py-16 border-b border-gray-100">
                <div class="container mx-auto px-4 text-center">
                    <span class="text-brand-600 font-bold tracking-widest text-xs uppercase mb-2 block">Educação Financeira</span>
                    <h1 class="text-4xl md:text-5xl font-extrabold text-black mb-6">Blog CrediFácil</h1>
                    <p class="text-gray-500 max-w-2xl mx-auto text-lg">Conteúdo aprofundado para você dominar seu dinheiro.</p>
                </div>
            </div>

            <div class="bg-gray-50 min-h-screen py-12">
                <div class="container mx-auto px-4 grid lg:grid-cols-12 gap-8">
                    <!-- Conteúdo Principal -->
                    <div class="lg:col-span-8">
                        <!-- Filtros Categoria -->
                        <div class="flex flex-wrap gap-2 justify-center lg:justify-start mb-8">
                            <button onclick="filterBlog('todos')" class="blog-filter-btn px-4 py-2 bg-black text-white rounded-lg text-sm font-bold">Todos</button>
                            <button onclick="filterBlog('Score')" class="blog-filter-btn px-4 py-2 bg-white border border-gray-200 hover:border-black text-gray-600 hover:text-black rounded-lg text-sm font-medium transition">Score</button>
                            <button onclick="filterBlog('Cartões')" class="blog-filter-btn px-4 py-2 bg-white border border-gray-200 hover:border-black text-gray-600 hover:text-black rounded-lg text-sm font-medium transition">Cartões</button>
                            <button onclick="filterBlog('Empréstimos')" class="blog-filter-btn px-4 py-2 bg-white border border-gray-200 hover:border-black text-gray-600 hover:text-black rounded-lg text-sm font-medium transition">Empréstimos</button>
                            <button onclick="filterBlog('Dívidas')" class="blog-filter-btn px-4 py-2 bg-white border border-gray-200 hover:border-black text-gray-600 hover:text-black rounded-lg text-sm font-medium transition">Dívidas</button>
                        </div>

                        <div id="blog-list-container" class="grid md:grid-cols-2 gap-8">
                            <!-- Renderização completa via JS -->
                            <div class="col-span-full text-center py-12"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-brand-500 mx-auto"></div></div>
                        </div>
                        
                        <!-- Paginação -->
                        <div id="pagination-controls" class="flex justify-center items-center gap-2 mt-16">
                            <!-- Injetado via JS -->
                        </div>
                    </div>

                    <!-- Sidebar do Blog -->
                    <aside class="lg:col-span-4 space-y-8">
                        <!-- Search Widget -->
                        <div class="bg-white p-6 rounded-2xl border border-gray-200 shadow-sm">
                            <h4 class="font-bold text-lg mb-4 text-black">Buscar Artigo</h4>
                            <div class="relative">
                                <input type="text" id="blog-search-input" onkeyup="searchBlog()" placeholder="Digite para buscar..." class="w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:border-brand-400 transition">
                                <i class="ph-bold ph-magnifying-glass absolute left-3 top-3.5 text-gray-400"></i>
                            </div>
                        </div>

                        <!-- Widget Mais Lidos -->
                        <div class="bg-white p-6 rounded-2xl border border-gray-200 shadow-sm">
                            <h4 class="font-bold text-lg mb-4 flex items-center gap-2"><i class="ph-fill ph-fire text-orange-500"></i> Mais Lidos</h4>
                            <div id="trending-posts-widget" class="space-y-4">
                                <!-- Preenchido via JS -->
                            </div>
                        </div>
                        <div class="ad-slot bg-white rounded-xl shadow-sm border border-gray-200"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-1017585624443150" data-ad-slot="1234567890" data-ad-format="auto" data-full-width-responsive="true"></ins></div>
                    </aside>
                </div>
            </div>
        </section>

        <!-- ================= POST INDIVIDUAL ================= -->
        <section id="blog-post" class="page-section hidden-section fade-in">
            <div class="bg-white min-h-screen">
                <!-- Cabeçalho do Artigo -->
                <div class="bg-black text-white py-24 relative overflow-hidden">
                     <div class="absolute inset-0 bg-gradient-to-t from-black to-transparent opacity-80 z-10"></div>
                     <!-- Imagem de fundo opcional aqui se quiser -->
                    <div class="container mx-auto px-4 max-w-4xl text-center relative z-20">
                        <a href="#blog" class="inline-flex items-center gap-2 text-gray-400 hover:text-white mb-8 transition font-medium"><i class="ph-bold ph-arrow-left"></i> Voltar para o Blog</a>
                        <div class="mb-6"><span id="post-category" class="bg-brand-400 text-black px-3 py-1 rounded-md text-xs font-bold uppercase tracking-wider shadow-lg">Categoria</span></div>
                        <h1 id="post-title" class="text-3xl md:text-5xl lg:text-6xl font-extrabold mb-8 leading-tight font-serif text-white">Título do Artigo</h1>
                        <div class="flex flex-wrap items-center justify-center gap-6 text-gray-400 text-sm font-medium border-t border-gray-800 pt-8 mt-8 w-full max-w-lg mx-auto">
                            <div class="flex items-center gap-2"><i class="ph-fill ph-user-circle text-brand-400 text-lg"></i> <span id="post-author">Autor</span></div>
                            <div class="flex items-center gap-2"><i class="ph-fill ph-clock text-brand-400 text-lg"></i> <span id="post-date">Data</span></div>
                        </div>
                    </div>
                </div>

                <div class="container mx-auto px-4 py-16 flex flex-col lg:flex-row gap-16">
                    <!-- Conteúdo Principal -->
                    <article class="lg:w-[65%] mx-auto">
                        
                        <div id="post-content" class="rich-content text-lg text-gray-800">
                            <!-- Injetado via JS -->
                        </div>

                        <!-- Posts Relacionados (Novo) -->
                        <div id="related-posts-area" class="mt-16 pt-10 border-t border-gray-100 hidden">
                            <h3 class="text-2xl font-bold mb-6">Você também pode gostar</h3>
                            <div id="related-posts-grid" class="grid md:grid-cols-2 gap-6">
                                <!-- Injetado -->
                            </div>
                        </div>

                         <!-- Share Bar (Bottom) -->
                         <div class="mt-12 mb-8 border-t border-b border-gray-100 py-6 flex flex-wrap items-center gap-4 justify-center">
                            <span class="text-sm font-bold text-gray-500 uppercase tracking-wide flex items-center mr-2">Compartilhar:</span>
                            <button onclick="sharePost('whatsapp')" class="bg-white text-gray-400 border border-gray-200 p-3 rounded-full hover:text-[#25D366] hover:border-[#25D366] transition shadow-sm"><i class="ph-fill ph-whatsapp-logo text-xl"></i></button>
                            <button onclick="sharePost('facebook')" class="bg-white text-gray-400 border border-gray-200 p-3 rounded-full hover:text-[#1877F2] hover:border-[#1877F2] transition shadow-sm"><i class="ph-fill ph-facebook-logo text-xl"></i></button>
                            <button onclick="sharePost('twitter')" class="bg-white text-gray-400 border border-gray-200 p-3 rounded-full hover:text-black hover:border-black transition shadow-sm"><i class="ph-fill ph-x-logo text-xl"></i></button>
                        </div>
                        
                        <!-- Engagement Box -->
                        <div class="mt-8 bg-gray-50 rounded-2xl p-8 border border-gray-200">
                            <div class="flex flex-col sm:flex-row items-center justify-between gap-6 mb-8 border-b border-gray-200 pb-8">
                                <div>
                                    <h3 class="text-xl font-bold text-black mb-1">Gostou da leitura?</h3>
                                    <p class="text-gray-500 text-sm">Deixe seu like para sabermos que este conteúdo ajudou.</p>
                                </div>
                                <button id="like-btn" onclick="toggleLike()" class="flex items-center gap-4 px-10 py-4 bg-white border-2 border-gray-100 hover:border-brand-400 rounded-full transition-all group shadow-sm transform hover:-translate-y-1">
                                    <i id="like-icon" class="ph-bold ph-thumbs-up text-3xl text-gray-300 group-hover:text-brand-500 transition duration-300"></i>
                                    <span id="like-count" class="font-bold text-gray-700 text-xl">0</span>
                                </button>
                            </div>

                            <h4 class="text-lg font-bold mb-6 flex items-center gap-2"><i class="ph-bold ph-chat-circle-text"></i> Comentários (<span id="comment-count">0</span>)</h4>
                            
                            <div id="comments-list" class="space-y-4 mb-8 max-h-[600px] overflow-y-auto custom-scrollbar pr-2"></div>

                            <form onsubmit="submitComment(event)" class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm mt-6">
                                <h5 class="text-sm font-bold mb-4">Deixe seu comentário</h5>
                                <div class="mb-4">
                                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Seu Nome</label>
                                    <input type="text" id="comment-name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-black focus:ring-1 focus:ring-black outline-none transition" required>
                                </div>
                                <div class="mb-4">
                                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Comentário</label>
                                    <textarea id="comment-text" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-black focus:ring-1 focus:ring-black outline-none transition resize-none" required></textarea>
                                </div>
                                <button type="submit" class="bg-black text-white px-6 py-2 rounded-lg font-bold hover:bg-gray-800 transition text-sm">Publicar Comentário</button>
                            </form>
                        </div>
                    </article>

                    <!-- Sidebar -->
                    <aside class="lg:w-[30%] space-y-8 hidden lg:block">
                        <div class="sticky top-24 space-y-8">
                            <div class="bg-brand-50 p-6 rounded-2xl border border-brand-100">
                                <h4 class="font-bold text-brand-900 mb-2">Simulação Rápida</h4>
                                <p class="text-sm text-brand-800 mb-4">Precisa de dinheiro urgente? Simule sem compromisso.</p>
                                <a href="#emprestimo" class="block w-full text-center bg-brand-500 hover:bg-brand-600 text-white font-bold py-3 rounded-lg transition shadow-md">Simular Agora</a>
                            </div>
                            <div class="ad-slot bg-white rounded-xl shadow-sm border border-gray-200"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-1017585624443150" data-ad-slot="1234567890" data-ad-format="auto" data-full-width-responsive="true"></ins></div>
                        </div>
                    </aside>
                </div>
            </div>
        </section>

        <!-- ================= ADMIN CMS (Completo) ================= -->
        <section id="admin" class="page-section hidden-section fade-in">
            <!-- Login Overlay -->
            <div id="admin-login" class="min-h-screen bg-gray-100 flex items-center justify-center p-4">
                <div class="bg-white p-10 rounded-2xl border border-gray-200 shadow-xl max-w-md w-full">
                    <div class="text-center mb-8">
                        <div class="bg-gray-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 text-gray-600"><i class="ph-fill ph-lock-key text-3xl"></i></div>
                        <h2 class="text-2xl font-bold text-black">Acesso CMS</h2>
                        <p class="text-gray-500 text-sm mt-2">Área restrita a administradores.</p>
                    </div>
                    <form onsubmit="handleLogin(event)" class="space-y-5">
                        <div><label class="block text-sm font-bold text-gray-700 mb-2">E-mail</label><input type="email" id="login-email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-black outline-none transition" required></div>
                        <div><label class="block text-sm font-bold text-gray-700 mb-2">Senha</label><input type="password" id="login-password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-black outline-none transition" required></div>
                        <button type="submit" class="w-full bg-black text-white hover:bg-gray-800 font-bold py-3 rounded-lg transition shadow-lg">Entrar no Painel</button>
                        <p id="login-error" class="text-red-500 text-sm text-center hidden font-bold bg-red-50 p-2 rounded-lg"></p>
                    </form>
                </div>
            </div>

            <!-- Dashboard Layout -->
            <div id="admin-panel" class="hidden min-h-screen bg-gray-100 flex overflow-hidden">
                <!-- Sidebar (Fixed) -->
                <aside id="admin-sidebar" class="w-64 bg-zinc-900 text-gray-400 flex flex-col fixed h-full z-20 transition-all duration-300 ease-in-out border-r border-gray-800">
                    <div class="h-16 flex items-center justify-between px-4 border-b border-gray-800 shrink-0">
                        <span class="font-bold text-xl text-white tracking-tight logo-text truncate">Credi<span class="text-brand-400">Admin</span></span>
                        <button onclick="toggleSidebar()" class="text-gray-400 hover:text-white p-1 rounded-md hover:bg-gray-800"><i class="ph-bold ph-list text-xl"></i></button>
                    </div>
                    
                    <!-- User Profile & Logout (Moved to top) -->
                    <div class="p-3 border-b border-gray-800 shrink-0">
                        <div class="flex items-center gap-3 mb-3 px-2">
                             <div class="w-8 h-8 rounded-full bg-brand-400 flex items-center justify-center text-black font-bold text-xs shrink-0">A</div>
                             <div class="text-sm nav-text overflow-hidden">
                                 <p class="text-white font-bold truncate">Admin</p>
                                 <p class="text-xs truncate">Logado</p>
                             </div>
                        </div>
                        <button onclick="handleLogout()" class="w-full text-left px-2 text-sm text-red-400 hover:text-red-300 font-bold flex items-center gap-2 hover:bg-gray-800 p-2 rounded-lg transition" title="Sair"><i class="ph-bold ph-sign-out text-lg shrink-0"></i> <span class="nav-text">Sair</span></button>
                    </div>

                    <nav class="flex-1 p-3 space-y-1 overflow-y-auto custom-scrollbar">
                        <button onclick="switchAdminTab('dashboard')" id="tab-dashboard" class="w-full flex items-center gap-3 px-3 py-3 rounded-lg hover:bg-gray-800 hover:text-white transition bg-gray-800 text-white font-medium group" title="Dashboard">
                            <i class="ph-bold ph-squares-four text-xl shrink-0"></i> <span class="nav-text truncate">Dashboard</span>
                        </button>
                        <button onclick="switchAdminTab('posts')" id="tab-posts" class="w-full flex items-center gap-3 px-3 py-3 rounded-lg hover:bg-gray-800 hover:text-white transition font-medium group" title="Gerenciar Posts">
                            <i class="ph-bold ph-article text-xl shrink-0"></i> <span class="nav-text truncate">Gerenciar Posts</span>
                        </button>
                        <button onclick="switchAdminTab('notifications')" id="tab-notifications" class="w-full flex items-center gap-3 px-3 py-3 rounded-lg hover:bg-gray-800 hover:text-white transition font-medium group" title="Notificações">
                            <i class="ph-bold ph-bell text-xl shrink-0"></i> <span class="nav-text truncate">Notificações</span>
                        </button>
                    </nav>
                </aside>

                <!-- Content Area (Scrollable) -->
                <div id="admin-content" class="flex-1 ml-64 p-8 overflow-y-auto overflow-x-hidden h-screen transition-all duration-300 ease-in-out">
                    
                    <!-- View: Dashboard -->
                    <div id="view-dashboard" class="space-y-8 animate-fade-in">
                        <h2 class="text-2xl font-bold text-black mb-6">Visão Geral</h2>
                        
                        <!-- Stats Grid -->
                        <div class="grid md:grid-cols-4 gap-6">
                            <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                                <div class="flex justify-between items-start mb-4">
                                    <div><p class="text-sm text-gray-500 font-medium">Total de Artigos</p><h3 id="stat-total-posts" class="text-3xl font-bold text-gray-900 mt-1">0</h3></div>
                                    <div class="bg-blue-50 p-2 rounded-lg text-blue-600"><i class="ph-fill ph-article text-xl"></i></div>
                                </div>
                            </div>
                            <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                                <div class="flex justify-between items-start mb-4">
                                    <div><p class="text-sm text-gray-500 font-medium">Visualizações</p><h3 id="stat-total-views" class="text-3xl font-bold text-gray-900 mt-1">0</h3></div>
                                    <div class="bg-green-50 p-2 rounded-lg text-green-600"><i class="ph-fill ph-eye text-xl"></i></div>
                                </div>
                            </div>
                            <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                                <div class="flex justify-between items-start mb-4">
                                    <div><p class="text-sm text-gray-500 font-medium">Engajamento (Likes)</p><h3 id="stat-total-likes" class="text-3xl font-bold text-gray-900 mt-1">0</h3></div>
                                    <div class="bg-purple-50 p-2 rounded-lg text-purple-600"><i class="ph-fill ph-heart text-xl"></i></div>
                                </div>
                            </div>
                            <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                                <div class="flex justify-between items-start mb-4">
                                    <div><p class="text-sm text-gray-500 font-medium">Notificações</p><h3 id="stat-notifications" class="text-3xl font-bold text-gray-900 mt-1">0</h3></div>
                                    <div class="bg-red-50 p-2 rounded-lg text-red-600"><i class="ph-fill ph-chat-circle text-xl"></i></div>
                                </div>
                            </div>
                        </div>

                        <!-- Gráfico Simulado (CSS) -->
                        <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                            <h3 class="font-bold text-gray-800 mb-6">Performance Recente</h3>
                            <div class="h-48 flex items-end justify-between gap-2 px-4">
                                <div class="w-full bg-gray-100 rounded-t h-[40%] hover:bg-brand-200 transition relative group"><span class="absolute -top-6 left-1/2 -translate-x-1/2 text-xs opacity-0 group-hover:opacity-100">40%</span></div>
                                <div class="w-full bg-gray-100 rounded-t h-[60%] hover:bg-brand-200 transition relative group"><span class="absolute -top-6 left-1/2 -translate-x-1/2 text-xs opacity-0 group-hover:opacity-100">60%</span></div>
                                <div class="w-full bg-gray-100 rounded-t h-[30%] hover:bg-brand-200 transition relative group"><span class="absolute -top-6 left-1/2 -translate-x-1/2 text-xs opacity-0 group-hover:opacity-100">30%</span></div>
                                <div class="w-full bg-gray-100 rounded-t h-[80%] hover:bg-brand-200 transition relative group"><span class="absolute -top-6 left-1/2 -translate-x-1/2 text-xs opacity-0 group-hover:opacity-100">80%</span></div>
                                <div class="w-full bg-brand-400 rounded-t h-[95%] relative group shadow-lg"><span class="absolute -top-6 left-1/2 -translate-x-1/2 text-xs font-bold">Hoje</span></div>
                            </div>
                        </div>
                    </div>

                    <!-- View: Posts Manager -->
                    <div id="view-posts" class="space-y-6 hidden animate-fade-in">
                        <div class="flex justify-between items-center">
                            <h2 class="text-2xl font-bold text-black">Gerenciar Posts</h2>
                            <button onclick="showPostEditor()" class="bg-black text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-gray-800 transition flex items-center gap-2">
                                <i class="ph-bold ph-plus"></i> Novo Post
                            </button>
                        </div>

                        <!-- Posts Table Container -->
                        <div id="posts-table-container" class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
                            <div class="p-4 border-b border-gray-200 flex gap-4">
                                <div class="relative flex-1">
                                    <input type="text" id="admin-search-posts" onkeyup="filterAdminPosts()" placeholder="Buscar por título..." class="w-full pl-9 pr-4 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:border-black">
                                    <i class="ph-bold ph-magnifying-glass absolute left-3 top-2.5 text-gray-400 text-sm"></i>
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full text-left text-sm text-gray-600">
                                    <thead class="bg-gray-50 text-gray-900 font-bold border-b border-gray-200">
                                        <tr>
                                            <th class="px-6 py-4">Título</th>
                                            <th class="px-6 py-4">Categoria</th>
                                            <th class="px-6 py-4">Data</th>
                                            <th class="px-6 py-4 text-center">Views</th>
                                            <th class="px-6 py-4 text-right">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="admin-posts-table-body" class="divide-y divide-gray-100">
                                        <!-- Preenchido via JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Post Editor (Hidden by default) -->
                        <div id="post-editor" class="hidden bg-white p-8 rounded-xl border border-gray-200 shadow-xl">
                            <div class="flex justify-between items-center mb-6 pb-4 border-b border-gray-100">
                                <h2 class="text-xl font-bold text-black flex items-center gap-2" id="form-title">Editor</h2>
                                <button onclick="hidePostEditor()" class="text-gray-500 hover:text-black font-medium text-sm">Cancelar</button>
                            </div>
                            <form onsubmit="savePost(event)" class="space-y-6">
                                <input type="hidden" id="admin-post-id">
                                <div><label class="block text-sm font-bold text-gray-700 mb-2">Título do Post</label><input type="text" id="admin-title" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-brand-500 outline-none transition" required></div>
                                
                                <div class="grid grid-cols-2 gap-6">
                                    <div><label class="block text-sm font-bold text-gray-700 mb-2">Categoria</label><select id="admin-category" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-brand-500 outline-none bg-white"><option>Score</option><option>Cartões</option><option>Empréstimos</option><option>Dívidas</option><option>Educação</option></select></div>
                                    <div><label class="block text-sm font-bold text-gray-700 mb-2">Autor</label><input type="text" id="admin-author" value="Redação CrediFácil" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-brand-500 outline-none"></div>
                                </div>
                                
                                <div><label class="block text-sm font-bold text-gray-700 mb-2">URL da Imagem</label><input type="text" id="admin-image" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-brand-500 outline-none" placeholder="https://..." required></div>
                                <div><label class="block text-sm font-bold text-gray-700 mb-2">Resumo (Intro)</label><textarea id="admin-intro" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-brand-500 outline-none resize-none"></textarea></div>
                                
                                <!-- Editor Rico -->
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-2">Conteúdo Completo</label>
                                    <div class="rich-editor-toolbar">
                                        <button type="button" class="rich-editor-btn" onclick="formatDoc('bold')" title="Negrito"><b>B</b></button>
                                        <button type="button" class="rich-editor-btn" onclick="formatDoc('italic')" title="Itálico"><i>I</i></button>
                                        <button type="button" class="rich-editor-btn" onclick="formatDoc('underline')" title="Sublinhado"><u>U</u></button>
                                        <div class="w-px h-6 bg-gray-300 mx-1"></div>
                                        <button type="button" class="rich-editor-btn" onclick="formatDoc('formatBlock', 'h2')" title="Subtítulo H2">H2</button>
                                        <button type="button" class="rich-editor-btn" onclick="formatDoc('formatBlock', 'h3')" title="Subtítulo H3">H3</button>
                                        <button type="button" class="rich-editor-btn" onclick="formatDoc('formatBlock', 'p')" title="Parágrafo">P</button>
                                        <button type="button" class="rich-editor-btn" onclick="formatDoc('formatBlock', 'blockquote')" title="Citação">“</button>
                                        <div class="w-px h-6 bg-gray-300 mx-1"></div>
                                        <button type="button" class="rich-editor-btn" onclick="formatDoc('insertUnorderedList')" title="Lista">• Lista</button>
                                        <button type="button" class="rich-editor-btn" onclick="formatDoc('insertOrderedList')" title="Numerada">1. Lista</button>
                                        <button type="button" class="rich-editor-btn" onclick="addLink()" title="Link">Link</button>
                                        <button type="button" class="rich-editor-btn font-bold text-brand-600" onclick="insertImage()" title="Inserir Imagem"><i class="ph-bold ph-image"></i> IMG</button>
                                    </div>
                                    <div id="admin-content-rich" contenteditable="true" class="rich-editor-content"></div>
                                </div>

                                <button type="submit" id="admin-submit-btn" class="w-full bg-black hover:bg-gray-800 text-white font-bold py-4 rounded-xl transition shadow-lg text-lg">Publicar Artigo</button>
                            </form>
                        </div>
                    </div>

                    <!-- View: Notifications/Comments -->
                    <div id="view-notifications" class="hidden animate-fade-in">
                        <h2 class="text-2xl font-bold text-black mb-6">Central de Notificações</h2>
                        <div class="bg-white rounded-xl border border-gray-200 shadow-sm p-6">
                             <div id="notifications-list" class="space-y-4">
                                <!-- Lista carregada via JS -->
                                <p class="text-gray-400 text-center py-4">Carregando...</p>
                             </div>
                        </div>
                    </div>

                </div>
            </div>
        </section>

        <!-- ================= SOBRE ================= -->
        <section id="sobre" class="page-section hidden-section fade-in">
            <div class="bg-white py-24">
                <div class="container mx-auto px-4 max-w-4xl text-center">
                    <div class="inline-block p-5 rounded-3xl bg-brand-50 text-brand-600 mb-8"><i class="ph-fill ph-users-three text-5xl"></i></div>
                    <h1 class="text-4xl md:text-5xl font-bold text-black mb-8">Nossa Missão</h1>
                    <div class="prose prose-lg mx-auto text-gray-600 leading-relaxed space-y-6 text-left md:text-center">
                        <p>O <strong>CrediFácil</strong> nasceu de uma necessidade real: simplificar o acesso ao crédito no Brasil. Sabemos que mais de 60 milhões de brasileiros enfrentam restrições financeiras e a falta de informação clara apenas agrava o problema.</p>
                        <p>Não somos um banco. Somos uma plataforma de tecnologia e educação que conecta você às melhores oportunidades do mercado, filtrando burocracias e traduzindo o "economês" para o português claro.</p>
                        <p>Acreditamos que todos merecem uma segunda chance e acesso a produtos financeiros justos. Por isso, trabalhamos incansavelmente para trazer as melhores opções de cartões e empréstimos, mesmo para quem está negativado.</p>
                    </div>
                    
                    <div class="grid md:grid-cols-3 gap-8 mt-16 text-left">
                        <div class="p-6 bg-gray-50 rounded-2xl border border-gray-100">
                            <h3 class="font-bold text-black text-xl mb-2">Transparência</h3>
                            <p class="text-gray-600 text-sm">Nunca cobramos valores antecipados. Nossas simulações mostram custos reais e sem letras miúdas.</p>
                        </div>
                        <div class="p-6 bg-gray-50 rounded-2xl border border-gray-100">
                            <h3 class="font-bold text-black text-xl mb-2">Segurança</h3>
                            <p class="text-gray-600 text-sm">Seguimos rigorosamente a LGPD. Seus dados são criptografados e usados apenas para a simulação solicitada.</p>
                        </div>
                        <div class="p-6 bg-gray-50 rounded-2xl border border-gray-100">
                            <h3 class="font-bold text-black text-xl mb-2">Imparcialidade</h3>
                            <p class="text-gray-600 text-sm">Nossas análises de cartões e empréstimos são baseadas em fatos técnicos, não apenas em comissões.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ================= TERMS ================= -->
        <section id="terms" class="page-section hidden-section fade-in">
            <div class="bg-white py-20">
                <div class="container mx-auto px-4 max-w-3xl">
                    <h1 class="text-3xl font-bold text-black mb-8 pb-4 border-b border-gray-200">Termos de Uso</h1>
                    <div class="prose prose-gray text-gray-700 space-y-4">
                        <p><strong>Última atualização: Janeiro de 2025</strong></p>
                        <p>Bem-vindo ao CrediFácil. Ao acessar e utilizar este website, você concorda expressamente em cumprir e vincular-se aos seguintes termos e condições de uso, que regem a relação entre o CrediFácil e você.</p>
                        
                        <h3 class="font-bold text-black text-xl mt-6">1. Natureza Informativa e Não-Bancária</h3>
                        <p>O CrediFácil é estritamente um portal de conteúdo, educação financeira e comparação de produtos. <strong>Não somos uma instituição financeira, banco ou seguradora</strong>. Não concedemos empréstimos, não emitimos cartões de crédito e não realizamos aprovações de crédito diretamente. Nosso papel é intermediar a informação.</p>
                        
                        <h3 class="font-bold text-black text-xl mt-6">2. Isenção de Responsabilidade sobre Aprovações</h3>
                        <p>As simulações apresentadas em nosso site são estimativas baseadas em dados médios de mercado. A aprovação final do crédito, as taxas de juros exatas, o Custo Efetivo Total (CET) e os limites de crédito são de responsabilidade exclusiva dos parceiros anunciantes (bancos, financeiras e fintechs). A concessão de crédito está sujeita à análise do perfil financeiro do usuário por essas instituições.</p>
                        <p>O CrediFácil não se responsabiliza por eventuais divergências entre os valores simulados em nossa plataforma e os valores finais ofertados pela instituição financeira no momento da contratação.</p>

                        <h3 class="font-bold text-black text-xl mt-6">3. Uso de Links Externos</h3>
                        <p>Nosso site contém links que redirecionam para sites de terceiros (bancos parceiros, anunciantes, etc.). Ao clicar nestes links, você estará sujeito aos termos de uso e políticas de privacidade daquele site específico. Não temos controle sobre o conteúdo ou práticas de sites de terceiros e não assumimos responsabilidade por eles.</p>

                        <h3 class="font-bold text-black text-xl mt-6">4. Cobranças</h3>
                        <p>O uso do CrediFácil é totalmente gratuito para o usuário final. <strong>Jamais solicitamos depósitos antecipados</strong> para liberação de crédito ou taxas de análise. Caso alguém solicite pagamento em nome do CrediFácil, denuncie imediatamente, pois trata-se de fraude.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- ================= PRIVACY ================= -->
        <section id="privacy" class="page-section hidden-section fade-in">
            <div class="bg-white py-20">
                <div class="container mx-auto px-4 max-w-3xl">
                    <h1 class="text-3xl font-bold text-black mb-8 pb-4 border-b border-gray-200">Política de Privacidade</h1>
                    <div class="prose prose-gray text-gray-700 space-y-4">
                        <p>A sua privacidade é uma prioridade absoluta para o CrediFácil. Esta política descreve detalhadamente como coletamos, usamos, armazenamos e protegemos suas informações pessoais, em estrita conformidade com a Lei Geral de Proteção de Dados (LGPD - Lei nº 13.709/2018).</p>

                        <h3 class="font-bold text-black text-xl mt-6">1. Coleta de Dados</h3>
                        <p>Podemos coletar as seguintes categorias de informações:</p>
                        <ul class="list-disc pl-5">
                            <li><strong>Dados fornecidos por você:</strong> Informações inseridas voluntariamente nos simuladores ou formulários de contato, como nome, e-mail, faixa de renda estimada e perfil de crédito.</li>
                            <li><strong>Dados de navegação:</strong> Endereço IP, tipo de navegador, páginas visitadas e tempo de permanência, coletados de forma anonimizada para fins estatísticos e de melhoria da experiência.</li>
                        </ul>

                        <h3 class="font-bold text-black text-xl mt-6">2. Finalidade do Uso das Informações</h3>
                        <p>Os dados coletados são utilizados para:</p>
                        <ul class="list-disc pl-5">
                            <li>Personalizar as ofertas de crédito e cartões exibidas no simulador, adequando-as ao seu perfil financeiro.</li>
                            <li>Melhorar a funcionalidade, o design e o conteúdo do site baseando-se no comportamento dos usuários.</li>
                            <li>Enviar comunicações de marketing, newsletters ou alertas de novas ofertas, mas <strong>apenas mediante seu consentimento explícito (opt-in)</strong>.</li>
                        </ul>

                        <h3 class="font-bold text-black text-xl mt-6">3. Cookies e Publicidade (Google AdSense)</h3>
                        <p>Utilizamos cookies para otimizar sua experiência de navegação. Terceiros, incluindo o Google, usam cookies para veicular anúncios com base em suas visitas anteriores ao nosso website ou a outros websites.</p>
                        <p>Você pode optar por desativar a publicidade personalizada acessando as Configurações de Anúncios do Google ou ajustando as configurações do seu navegador para recusar cookies. Note que isso pode afetar a funcionalidade de algumas partes do site.</p>

                        <h3 class="font-bold text-black text-xl mt-6">4. Seus Direitos (LGPD)</h3>
                        <p>Você tem o direito de solicitar, a qualquer momento:</p>
                        <ul class="list-disc pl-5">
                            <li>A confirmação da existência de tratamento de seus dados.</li>
                            <li>O acesso aos dados que possuímos sobre você.</li>
                            <li>A correção de dados incompletos, inexatos ou desatualizados.</li>
                            <li>A anonimização, bloqueio ou eliminação de dados desnecessários ou tratados em desconformidade com a lei.</li>
                        </ul>
                        <p>Para exercer esses direitos, entre em contato conosco através do nosso canal oficial de atendimento.</p>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- ================= OFFER SCREEN ================= -->
        <section id="offer-screen" class="page-section hidden-section fade-in">
            <div class="min-h-screen bg-gray-50 flex flex-col justify-center py-12">
                <div class="container mx-auto px-4 max-w-xl">
                    <div class="bg-white rounded-3xl shadow-2xl overflow-hidden border border-gray-200">
                        <div class="bg-black p-8 text-center text-white"><h2 class="text-2xl font-bold mb-2">Oferta Selecionada</h2></div>
                        <div class="p-8 text-center">
                            <h3 id="offer-partner-name" class="text-3xl font-extrabold text-brand-600 mb-2">Banco</h3>
                            <div class="bg-gray-50 rounded-xl p-6 mb-8 border border-gray-100 flex justify-between">
                                <span class="text-gray-600">Valor: <b id="offer-value" class="text-black"></b></span>
                                <span class="text-brand-600 font-bold" id="offer-installments"></span>
                            </div>
                            <button id="offer-cta-btn" class="w-full bg-brand-400 hover:bg-brand-500 text-black font-bold py-4 rounded-xl transition shadow-lg text-lg mb-4">Concluir no Site Oficial</button>
                            <a href="#emprestimo" class="text-sm text-gray-400 hover:text-black">Cancelar</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Modal de Confirmação Exclusão -->
    <div id="delete-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center modal-overlay">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-sm w-full mx-4 animate-fade-in">
            <div class="text-center">
                <div class="bg-red-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 text-red-600"><i class="ph-bold ph-trash text-3xl"></i></div>
                <h3 class="text-xl font-bold text-gray-900 mb-2">Excluir?</h3>
                <p class="text-gray-500 text-sm mb-6">Esta ação é irreversível.</p>
                <div class="flex gap-3 justify-center">
                    <button onclick="closeDeleteModal()" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 font-bold transition">Cancelar</button>
                    <button id="confirm-delete-btn" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-bold transition shadow-lg">Sim, Excluir</button>
                </div>
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <footer class="bg-black text-gray-400 py-16 border-t border-gray-900 font-sans mt-auto">
        <div class="container mx-auto px-4">
            <div class="grid md:grid-cols-4 gap-12 mb-12">
                <div class="col-span-1 md:col-span-2">
                    <div class="flex items-center gap-2 text-white mb-6">
                        <i class="ph-fill ph-coins text-brand-400 text-2xl"></i>
                        <span class="font-bold text-2xl">CrediFácil</span>
                    </div>
                    <p class="text-sm leading-relaxed mb-6 max-w-md">Nossa missão é democratizar o acesso à informação financeira, ajudando brasileiros a saírem das dívidas e realizarem seus sonhos com crédito consciente.</p>
                    
                    <!-- NOVIDADE 4: Newsletter -->
                    <div class="mt-6">
                        <p class="text-xs text-brand-400 uppercase font-bold tracking-wide mb-2">Receba dicas grátis</p>
                        <form onsubmit="subscribeNewsletter(event)" class="flex gap-2 max-w-xs">
                            <input type="email" placeholder="Seu e-mail..." class="bg-gray-900 border border-gray-700 text-white text-sm px-4 py-2 rounded-lg outline-none focus:border-brand-400 w-full" required>
                            <button type="submit" class="bg-brand-400 hover:bg-brand-500 text-black px-4 py-2 rounded-lg font-bold text-sm transition"><i class="ph-bold ph-paper-plane-right"></i></button>
                        </form>
                    </div>
                </div>
                <div>
                    <h4 class="text-white font-bold mb-6 text-sm uppercase tracking-wider">Navegação</h4>
                    <ul class="space-y-3 text-sm">
                        <li><a href="#home" class="hover:text-brand-400 transition">Início</a></li>
                        <li><a href="#emprestimo" class="hover:text-brand-400 transition">Simulador</a></li>
                        <li><a href="#cartoes" class="hover:text-brand-400 transition">Melhores Cartões</a></li>
                        <li><a href="#blog" class="hover:text-brand-400 transition">Blog Educativo</a></li>
                        <li><a href="#sobre" class="hover:text-brand-400 transition">Quem Somos</a></li>
                    </ul>
                </div>
                <div>
                     <h4 class="text-white font-bold mb-6 text-sm uppercase tracking-wider">Legal</h4>
                    <ul class="space-y-3 text-sm">
                        <li><a href="#terms" class="hover:text-brand-400 transition">Termos de Uso</a></li>
                        <li><a href="#privacy" class="hover:text-brand-400 transition">Privacidade</a></li>
                        <li><a href="#admin" class="hover:text-brand-400 transition">Admin</a></li>
                    </ul>
                </div>
            </div>
            <div class="text-center text-sm pt-6 border-t border-gray-900">
                <p>&copy; 2025 CrediFácil. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>

    <!-- JS DO APP -->
    <script>
        // --- DADOS ---
        const loanPartners = [
            { name: "Nubank", url: "https://nubank.com.br/" }, 
            { name: "Banco Inter", url: "https://inter.co/" }, 
            { name: "Jeitto", url: "https://www.jeitto.com.br/" }, 
            { name: "Simplic", url: "https://www.simplic.com.br/" }
        ];

        const firebaseConfig = {
            apiKey: "AIzaSyCJA-eq22kpGxAfHBDCcMu8BGb8_I8NGlk",
            authDomain: "credifacil-ddb17.firebaseapp.com",
            projectId: "credifacil-ddb17",
            storageBucket: "credifacil-ddb17.firebasestorage.app",
            messagingSenderId: "473150441862",
            appId: "1:473150441862:web:8f7b1945fa27c519c90407"
        };

        let db, auth;
        let allBlogPosts = []; 
        let currentEditingId = null; 
        let currentBlogPage = 1;
        const postsPerPage = 6;
        let currentBlogCategory = 'todos';
        let deleteTarget = null; // { type: 'post' | 'comment' | 'notification', id: string, parentId?: string }

        // Variáveis globais para gráficos
        let viewsChartInstance = null;
        let categoryChartInstance = null;

        const cardsData = [
            { id: 1, name: "Santander SX", bgClass: "bg-red-600", iconBg: "bg-red-700", rotation: "rotate-45", badges: [{ text: "Aprovação Alta", color: "bg-green-100 text-green-700" }, { text: "Visa/Master", color: "bg-blue-100 text-blue-700" }], annuity: "Grátis (gastando R$100)", income: "R$ 1.045,00", desc: "Ideal para quem busca o primeiro cartão ou quer recuperar crédito.", link: "https://www.santander.com.br/cartao-credito-santander/sx", categories: ["todos", "negativados"] },
            { id: 2, name: "Roxinho Nubank", bgClass: "bg-purple-700", iconBg: "bg-purple-800", rotation: "-rotate-12", badges: [{ text: "Sem Anuidade", color: "bg-purple-100 text-purple-700" }], annuity: "R$ 0,00", income: "Não exigida", desc: "Controle total pelo app e atendimento humanizado.", link: "https://nubank.com.br/cartao/", categories: ["todos", "anuidade"] },
            { id: 3, name: "Inter Gold", bgClass: "bg-orange-500", iconBg: "bg-orange-400", isInter: true, badges: [{ text: "Cashback", color: "bg-orange-100 text-orange-700" }], annuity: "Grátis", income: "Não exigida", desc: "Super App completo com investimentos e shopping.", link: "https://inter.co/pra-voce/cartoes/", categories: ["todos", "milhas"] },
            { id: 7, name: "Will Bank", bgClass: "bg-yellow-400", iconBg: "bg-yellow-500", rotation: "rotate-12", badges: [{ text: "Fácil Aprovação", color: "bg-black text-white" }], annuity: "Grátis", income: "Não exigida", desc: "Cartão de crédito sem anuidade e sem burocracia.", link: "https://www.willbank.com.br/", categories: ["todos", "anuidade", "negativados"] },
            { id: 8, name: "Digio", bgClass: "bg-blue-800", iconBg: "bg-blue-900", rotation: "-rotate-3", badges: [{ text: "Sem Rotativo", color: "bg-blue-100 text-blue-700" }], annuity: "Grátis", income: "Salário Mínimo", desc: "Sem juros rotativos abusivos e totalmente digital.", link: "https://www.digio.com.br/", categories: ["todos", "anuidade"] }
        ];

        // --- INICIALIZAÇÃO ---
        document.addEventListener('DOMContentLoaded', () => {
            initFirebase();
            renderCards('todos');
            renderHistory();
            handleHashChange(); 
            window.addEventListener('hashchange', handleHashChange); 
            
            // Scroll Progress & Back Top Logic
            window.onscroll = function() {
                let winScroll = document.body.scrollTop || document.documentElement.scrollTop;
                let height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
                let scrolled = (winScroll / height) * 100;
                document.getElementById("reading-progress-bar").style.width = scrolled + "%";
                
                const backBtn = document.getElementById('back-top-btn');
                if (winScroll > 300) backBtn.classList.add('visible');
                else backBtn.classList.remove('visible');
            };
        });

        // --- NOVIDADES LÓGICA ---
        
        // 1. Calculadora de Saúde
        function calcFinancialHealth() {
            const inc = parseFloat(document.getElementById('health-income').value);
            const exp = parseFloat(document.getElementById('health-expenses').value);
            const resDiv = document.getElementById('health-result');
            const icon = document.getElementById('health-icon');
            const status = document.getElementById('health-status');
            const msg = document.getElementById('health-message');

            if(!inc || !exp) { showToast("Preencha todos os campos!", 'error'); return; }

            const ratio = (exp / inc) * 100;
            resDiv.classList.remove('hidden');

            if(ratio > 90) {
                resDiv.className = "mt-6 p-4 rounded-xl text-center bg-red-50 border border-red-200 text-red-800";
                icon.innerHTML = "🚨";
                status.innerText = "Alerta Vermelho!";
                msg.innerText = "Seus gastos estão consumindo quase tudo. Hora de cortar custos urgente.";
            } else if (ratio > 70) {
                resDiv.className = "mt-6 p-4 rounded-xl text-center bg-yellow-50 border border-yellow-200 text-yellow-800";
                icon.innerHTML = "⚠️";
                status.innerText = "Atenção!";
                msg.innerText = "Você está no limite. Tente economizar pelo menos 20% da renda.";
            } else {
                resDiv.className = "mt-6 p-4 rounded-xl text-center bg-green-50 border border-green-200 text-green-800";
                icon.innerHTML = "✅";
                status.innerText = "Saúde Excelente!";
                msg.innerText = "Parabéns! Suas finanças estão equilibradas. Ótimo momento para investir.";
            }
        }

        // 2. Newsletter
        function subscribeNewsletter(e) {
            e.preventDefault();
            const email = e.target.querySelector('input').value;
            if(email) {
                showToast("Inscrito com sucesso!");
                e.target.reset();
            }
        }

        // 3. Histórico de Simulações
        function saveToHistory(amount, installments, installmentValue) {
            let history = JSON.parse(localStorage.getItem('loan_history') || '[]');
            history.unshift({ date: new Date().toLocaleDateString('pt-BR'), amount, installments, val: installmentValue });
            history = history.slice(0, 3); // Keep last 3
            localStorage.setItem('loan_history', JSON.stringify(history));
            renderHistory();
        }

        function renderHistory() {
            const list = document.getElementById('loan-history-list');
            const container = document.getElementById('loan-history-widget');
            const history = JSON.parse(localStorage.getItem('loan_history') || '[]');
            
            if(history.length === 0) return;
            
            container.classList.remove('hidden');
            list.innerHTML = history.map(h => `
                <div class="flex justify-between items-center text-sm border-b border-gray-100 pb-2 last:border-0 last:pb-0">
                    <div>
                        <p class="font-bold text-gray-800">R$ ${h.amount}</p>
                        <p class="text-xs text-gray-500">${h.date}</p>
                    </div>
                    <div class="text-right">
                        <p class="font-bold text-brand-600">${h.installments}x R$ ${h.val}</p>
                    </div>
                </div>
            `).join('');
        }

        // --- UTILS ---
        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
            toast.className = `${bgColor} text-white px-6 py-3 rounded-lg shadow-lg font-bold text-sm flex items-center gap-2 toast-enter`;
            toast.innerHTML = `<i class="ph-bold ${type === 'success' ? 'ph-check' : 'ph-warning'}"></i> ${message}`;
            container.appendChild(toast);
            
            // Animate In
            requestAnimationFrame(() => {
                toast.classList.remove('toast-enter');
                toast.classList.add('toast-enter-active');
            });

            // Remove
            setTimeout(() => {
                toast.classList.remove('toast-enter-active');
                toast.classList.add('toast-exit-active');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function formatDate(timestamp) {
            if (!timestamp) return '';
            let date;
            if (timestamp.toDate) {
                date = timestamp.toDate();
            } else if (timestamp instanceof Date) {
                date = timestamp;
            } else {
                date = new Date(timestamp);
            }
            
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays <= 1) return "Hoje";
            if (diffDays <= 2) return "Ontem";
            if (diffDays < 7) return `Há ${diffDays} dias`;
            
            return date.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' });
        }

        // --- ROTEAMENTO ---
        function handleHashChange() {
            let hash = window.location.hash.replace('#', '') || 'home';
            const progress = document.getElementById('reading-progress-container');
            
            if (hash.startsWith('artigo-')) {
                const postId = hash.replace('artigo-', '');
                progress.style.display = 'block';
                if (allBlogPosts.length > 0) openArticle(postId);
                else { /* Aguarda fetch */ }
                return; 
            } else {
                progress.style.display = 'none';
            }

            document.querySelectorAll('.page-section').forEach(s => s.classList.add('hidden-section'));
            
            const section = document.getElementById(hash);
            if(section) {
                section.classList.remove('hidden-section');
                section.classList.remove('fade-in');
                void section.offsetWidth; 
                section.classList.add('fade-in');
                window.scrollTo(0,0);
            }
        }
        
        function navigateToHash(hash) { window.location.hash = hash; }

        function initFirebase() {
            try {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                auth = firebase.auth();
                
                auth.onAuthStateChanged(user => {
                    const loginForm = document.getElementById('admin-login');
                    const panel = document.getElementById('admin-panel');
                    if (user) { 
                        loginForm.classList.add('hidden'); 
                        panel.classList.remove('hidden'); 
                        loadAdminPostsTable(); 
                        updateAdminStats(); 
                        loadAdminNotifications(); 
                        showToast("Bem-vindo de volta, Admin!");
                    } else { 
                        loginForm.classList.remove('hidden'); 
                        panel.classList.add('hidden'); 
                    }
                });

                fetchBlogPosts();
            } catch (e) {
                console.error("Erro Firebase:", e);
            }
        }

        // --- BLOG E LÓGICA ---
        async function fetchBlogPosts() {
            if (!db) return;
            
            const mockPosts = [
                {
                    id: 'demo-1',
                    title: 'Como aumentar seu Score em 30 dias',
                    category: 'Score',
                    intro: 'Descubra as 5 práticas infalíveis para subir sua pontuação no Serasa e conseguir crédito mais fácil.',
                    content: '<p>Ter um bom score é fundamental para conseguir as melhores taxas de juros no mercado. Muitas pessoas acreditam que é impossível recuperar o crédito, mas com disciplina e as estratégias certas, você pode virar o jogo em pouco tempo.</p><h3>1. Limpe seu nome</h3><p>O primeiro passo é óbvio: negocie suas dívidas. Muitas empresas oferecem descontos de até 90%.</p>',
                    image: 'https://images.unsplash.com/photo-1554224155-6726b3ff858f?auto=format&fit=crop&q=80&w=800',
                    createdAt: new Date(),
                    views: 120,
                    likes: 45
                },
                {
                    id: 'demo-2',
                    title: 'Empréstimo para negativado: Vale a pena?',
                    category: 'Empréstimos',
                    intro: 'Analisamos as principais opções do mercado para quem está com o nome sujo na praça.',
                    content: '<p>Muitas financeiras oferecem crédito para quem está negativado, mas é preciso ter cuidado com os juros abusivos. Neste artigo, comparamos as taxas da Crefisa, Simplic e outros parceiros.</p>',
                    image: 'https://images.unsplash.com/photo-1579621970563-ebec7560ff3e?auto=format&fit=crop&q=80&w=800',
                    createdAt: new Date(Date.now() - 86400000),
                    views: 85,
                    likes: 12
                },
                {
                    id: 'demo-3',
                    title: 'Cartão de Crédito sem anuidade',
                    category: 'Cartões',
                    intro: 'Lista atualizada dos melhores cartões que não cobram nada para você usar.',
                    content: '<p>Economizar na anuidade é o primeiro passo para organizar suas finanças. Bancos digitais como Nubank e Inter revolucionaram o mercado.</p>',
                    image: 'https://images.unsplash.com/photo-1559526324-4b87b5e36e44?auto=format&fit=crop&q=80&w=800',
                    createdAt: new Date(Date.now() - 172800000),
                    views: 200,
                    likes: 89
                },
                 {
                    id: 'demo-4',
                    title: 'Saindo do Vermelho: Guia Prático',
                    category: 'Dívidas',
                    intro: 'Passo a passo para organizar suas finanças e nunca mais ficar endividado.',
                    content: '<p>O primeiro passo é mapear todos os seus gastos. Use nossa planilha ou aplicativo de gestão financeira.</p>',
                    image: 'https://images.unsplash.com/photo-1591033594798-33227a05780d?auto=format&fit=crop&q=80&w=800',
                    createdAt: new Date(Date.now() - 259200000),
                    views: 150,
                    likes: 30
                }
            ];

            try {
                // Tenta buscar do Firebase
                const snap = await db.collection("posts").orderBy("createdAt", "desc").limit(100).get();
                
                allBlogPosts = [];
                if (!snap.empty) {
                    snap.forEach(doc => allBlogPosts.push({ id: doc.id, ...doc.data() }));
                } else {
                    // Se o banco estiver vazio, usa o mock
                    allBlogPosts = mockPosts;
                }
            } catch (e) { 
                console.warn("Erro fetchBlog (usando fallback):", e);
                // SE DER ERRO NO FIREBASE, USA O MOCK DATA PARA NÃO QUEBRAR
                allBlogPosts = mockPosts;
            }

            // Renderiza sempre (seja dados reais ou mock)
            renderHomeBlog();
            renderBlogPage('todos');
            renderTrendingPosts(); 
            
            if(auth.currentUser) {
                updateAdminStats();
                loadAdminPostsTable();
            }
            
            if (window.location.hash.startsWith('#artigo-')) handleHashChange();
        }

        // --- NOVAS FUNÇÕES ADICIONADAS PARA CORRIGIR ERROS ---

        function renderHomeBlog() {
            const grid = document.getElementById('home-blog-grid');
            if(!grid) return;
            const recentPosts = allBlogPosts.slice(0, 4);
            grid.innerHTML = recentPosts.map(post => `
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-lg transition cursor-pointer group flex flex-col h-full" onclick="openArticle('${post.id}')">
                    <div class="h-40 overflow-hidden relative">
                        <img src="${post.image}" class="w-full h-full object-cover group-hover:scale-105 transition duration-500">
                        <span class="absolute top-3 left-3 bg-white/90 backdrop-blur text-xs font-bold px-2 py-1 rounded text-black">${post.category}</span>
                    </div>
                    <div class="p-5 flex-1 flex flex-col">
                        <h3 class="font-bold text-gray-900 mb-2 leading-tight group-hover:text-brand-600 transition line-clamp-2">${post.title}</h3>
                        <p class="text-gray-500 text-xs mb-3 line-clamp-3 flex-1">${post.intro}</p>
                        <span class="text-brand-600 text-xs font-bold flex items-center gap-1 mt-auto">Ler mais <i class="ph-bold ph-arrow-right"></i></span>
                    </div>
                </div>
            `).join('');
        }

        function filterBlog(category) {
            currentBlogCategory = category;
            currentBlogPage = 1;
            document.getElementById('blog-search-input').value = ''; 
            
            document.querySelectorAll('.blog-filter-btn').forEach(btn => {
                btn.className = "blog-filter-btn px-4 py-2 bg-white border border-gray-200 hover:border-black text-gray-600 hover:text-black rounded-lg text-sm font-medium transition";
            });
            event.target.className = "blog-filter-btn px-4 py-2 bg-black text-white rounded-lg text-sm font-bold shadow-md";
            renderBlogPage();
        }

        function searchBlog() {
            const term = document.getElementById('blog-search-input').value.toLowerCase();
            const container = document.getElementById('blog-list-container');
            
            const filtered = allBlogPosts.filter(p => 
                p.title.toLowerCase().includes(term) || 
                p.intro.toLowerCase().includes(term)
            );
            
            if(filtered.length === 0) {
                 container.innerHTML = `<div class="col-span-full text-center py-12"><p class="text-gray-500">Nada encontrado para "${term}".</p></div>`;
            } else {
                renderBlogList(filtered, container);
            }
            document.getElementById('pagination-controls').innerHTML = ''; 
        }

        function renderBlogPage() {
            const container = document.getElementById('blog-list-container');
            const paginationContainer = document.getElementById('pagination-controls');
            if(!container) return;
            
            const filtered = (currentBlogCategory === 'todos') ? allBlogPosts : allBlogPosts.filter(p => p.category === currentBlogCategory);
            
            if(filtered.length === 0) {
                container.innerHTML = `<div class="col-span-full text-center py-12"><p class="text-gray-500">Nenhum artigo encontrado nesta categoria.</p></div>`;
                paginationContainer.innerHTML = '';
                return;
            }

            const totalPages = Math.ceil(filtered.length / postsPerPage);
            const startIndex = (currentBlogPage - 1) * postsPerPage;
            const endIndex = startIndex + postsPerPage;
            const postsToShow = filtered.slice(startIndex, endIndex);

            renderBlogList(postsToShow, container);

            let paginationHTML = '';
            if (totalPages > 1) {
                for (let i = 1; i <= totalPages; i++) {
                    const activeClass = i === currentBlogPage ? 'bg-black text-white font-bold' : 'bg-white text-gray-600 border border-gray-200 hover:border-black hover:text-black';
                    paginationHTML += `<button onclick="changeBlogPage(${i})" class="w-10 h-10 rounded-lg flex items-center justify-center text-sm transition ${activeClass}">${i}</button>`;
                }
            }
            paginationContainer.innerHTML = paginationHTML;
        }

        function renderBlogList(posts, container) {
             container.innerHTML = posts.map(post => `
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-xl transition cursor-pointer flex flex-col group h-full" onclick="openArticle('${post.id}')">
                    <div class="h-52 overflow-hidden relative">
                        <img src="${post.image}" class="w-full h-full object-cover group-hover:scale-105 transition duration-700">
                        <div class="absolute bottom-0 left-0 w-full h-1/2 bg-gradient-to-t from-black/60 to-transparent"></div>
                        <span class="absolute top-4 left-4 bg-brand-400 text-black px-3 py-1 rounded-md text-xs font-bold uppercase tracking-wide">${post.category}</span>
                    </div>
                    <div class="p-6 flex-1 flex flex-col">
                        <div class="flex items-center gap-2 text-xs text-gray-400 mb-3">
                            <span>${formatDate(post.createdAt)}</span>
                        </div>
                        <h3 class="text-xl font-bold text-black mb-3 group-hover:text-brand-600 transition leading-snug">${post.title}</h3>
                        <p class="text-gray-600 text-sm mb-4 line-clamp-3 flex-1 font-serif">${post.intro}</p>
                        <div class="pt-4 border-t border-gray-100 flex justify-between items-center mt-auto">
                            <span class="text-brand-600 font-bold text-sm flex items-center gap-2 group-hover:gap-3 transition-all">Ler Artigo Completo <i class="ph-bold ph-arrow-right"></i></span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function changeBlogPage(page) {
            currentBlogPage = page;
            renderBlogPage();
            document.getElementById('blog').scrollIntoView({behavior: 'smooth'});
        }

        function openArticle(id) {
            const post = allBlogPosts.find(p => p.id == id);
            if(!post) return;
            
            db.collection('posts').doc(id).update({ views: firebase.firestore.FieldValue.increment(1) }).catch(e => console.log(e));

            document.getElementById('post-title').textContent = post.title;
            document.getElementById('post-category').textContent = post.category;
            document.getElementById('post-author').textContent = post.author || 'Equipe CrediFácil';
            document.getElementById('post-date').textContent = formatDate(post.createdAt);
            document.title = post.title + " | CrediFácil";
            
            const contentDiv = document.getElementById('post-content');
            contentDiv.innerHTML = `<p class="text-xl md:text-2xl leading-relaxed mb-10 font-medium text-gray-600 border-l-4 border-brand-400 pl-6 intro-text font-serif italic">${post.intro}</p><div class="body-content">${post.content}</div>`;
            
            // Related Posts Logic
            const related = allBlogPosts.filter(p => p.category === post.category && p.id !== post.id).slice(0, 2);
            const relatedGrid = document.getElementById('related-posts-grid');
            const relatedArea = document.getElementById('related-posts-area');
            
            if(related.length > 0) {
                relatedArea.classList.remove('hidden');
                relatedGrid.innerHTML = related.map(rp => `
                    <div onclick="openArticle('${rp.id}')" class="flex gap-4 cursor-pointer group items-center bg-gray-50 p-4 rounded-xl hover:bg-white hover:shadow-md transition border border-transparent hover:border-gray-200">
                         <div class="w-20 h-20 rounded-lg overflow-hidden shrink-0"><img src="${rp.image}" class="w-full h-full object-cover"></div>
                         <div>
                            <span class="text-xs font-bold text-brand-600 uppercase">${rp.category}</span>
                            <h4 class="font-bold text-gray-900 group-hover:text-brand-600 leading-tight text-sm">${rp.title}</h4>
                         </div>
                    </div>
                `).join('');
            } else {
                relatedArea.classList.add('hidden');
            }

            const likeCountEl = document.getElementById('like-count');
            const likeIcon = document.getElementById('like-icon');
            if(likeCountEl) likeCountEl.textContent = post.likes || 0;
            
            if(localStorage.getItem(`liked_${id}`)) {
                likeIcon.classList.add('text-brand-500', 'ph-fill');
                likeIcon.classList.remove('text-gray-300', 'ph-bold');
            } else {
                likeIcon.classList.add('text-gray-300', 'ph-bold');
                likeIcon.classList.remove('text-brand-500', 'ph-fill');
            }

            db.collection("posts").doc(id).onSnapshot(doc => {
                if(doc.exists) document.getElementById('like-count').textContent = doc.data().likes || 0;
            });
            
            loadComments(id);
            window.currentPostTitle = post.title; 
            window.location.hash = 'artigo-' + id;
            
            // Reset scroll progress
            document.getElementById("reading-progress-bar").style.width = "0%";

            document.querySelectorAll('.page-section').forEach(s => s.classList.add('hidden-section'));
            const section = document.getElementById('blog-post');
            section.classList.remove('hidden-section');
            section.classList.remove('fade-in');
            void section.offsetWidth; 
            section.classList.add('fade-in');
            window.scrollTo(0,0);
        }

        // --- FIM DAS FUNÇÕES ADICIONADAS ---

        function renderTrendingPosts() {
            const container = document.getElementById('trending-posts-widget');
            if(!container) return;
            const trending = [...allBlogPosts].sort((a, b) => (b.views || 0) - (a.views || 0)).slice(0, 5);
            container.innerHTML = trending.map((post, index) => `
                <div onclick="openArticle('${post.id}')" class="flex gap-3 cursor-pointer group items-start">
                    <span class="text-2xl font-bold text-gray-200 group-hover:text-brand-400 transition">0${index + 1}</span>
                    <div>
                        <h5 class="font-bold text-gray-800 text-sm leading-tight group-hover:text-brand-600 transition line-clamp-2">${post.title}</h5>
                    </div>
                </div>
            `).join('');
        }

        // --- ADMIN DASHBOARD ---
        function toggleSidebar() {
            const sidebar = document.getElementById('admin-sidebar');
            const content = document.getElementById('admin-content');
            
            sidebar.classList.toggle('w-64');
            sidebar.classList.toggle('w-20');
            content.classList.toggle('ml-64');
            content.classList.toggle('ml-20');
            
            // Toggle Text Visibility
            document.querySelectorAll('.nav-text').forEach(el => el.classList.toggle('hidden'));
            
            // Adjust Logo
            const logo = document.querySelector('.logo-text');
            if (sidebar.classList.contains('w-20')) {
                logo.innerHTML = '<span class="text-brand-400">CA</span>';
            } else {
                logo.innerHTML = 'Credi<span class="text-brand-400">Admin</span>';
            }
        }

        function switchAdminTab(tabName) {
            document.querySelectorAll('[id^="view-"]').forEach(v => v.classList.add('hidden'));
            document.getElementById(`view-${tabName}`).classList.remove('hidden');
            
            document.querySelectorAll('[id^="tab-"]').forEach(t => {
                t.classList.remove('bg-gray-800');
                t.classList.add('hover:bg-gray-800');
            });
            document.getElementById(`tab-${tabName}`).classList.add('bg-gray-800');
        }

        function updateAdminStats() {
            const totalPosts = allBlogPosts.length;
            const totalViews = allBlogPosts.reduce((acc, curr) => acc + (curr.views || 0), 0);
            const totalLikes = allBlogPosts.reduce((acc, curr) => acc + (curr.likes || 0), 0);
            document.getElementById('stat-total-posts').textContent = totalPosts;
            document.getElementById('stat-total-views').textContent = totalViews;
            document.getElementById('stat-total-likes').textContent = totalLikes;

            // Renderizar Gráficos (Dashboard 2.0)
            renderDashboardCharts();
        }

        function renderDashboardCharts() {
            // Se não houver posts, não renderiza
            if (allBlogPosts.length === 0) return;

            const canvasViews = document.getElementById('viewsChart');
            const canvasCategory = document.getElementById('categoryChart');

            // Fix: Check if elements exist before getting context
            if (!canvasViews || !canvasCategory) return;

            // 1. Dados para o gráfico de Barras (Views por Categoria)
            const categories = {};
            allBlogPosts.forEach(post => {
                if (!categories[post.category]) categories[post.category] = 0;
                categories[post.category] += (post.views || 0);
            });
            const catLabels = Object.keys(categories);
            const catViews = Object.values(categories);

            // Destruir instância anterior se existir
            if (viewsChartInstance) viewsChartInstance.destroy();

            const ctxViews = canvasViews.getContext('2d');
            viewsChartInstance = new Chart(ctxViews, {
                type: 'bar',
                data: {
                    labels: catLabels,
                    datasets: [{
                        label: 'Visualizações',
                        data: catViews,
                        backgroundColor: '#FACC15',
                        borderRadius: 6,
                        barThickness: 40
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true, grid: { borderDash: [2, 4], color: '#f3f4f6' } },
                        x: { grid: { display: false } }
                    },
                    plugins: { legend: { display: false } }
                }
            });

            // 2. Dados para o gráfico de Rosca (Distribuição de Conteúdo)
            const catCount = {};
            allBlogPosts.forEach(post => {
                if (!catCount[post.category]) catCount[post.category] = 0;
                catCount[post.category]++;
            });
            
            // Achar categoria top
            let topCat = '-';
            let maxCount = -1;
            for (const [key, val] of Object.entries(catCount)) {
                if (val > maxCount) { maxCount = val; topCat = key; }
            }
            document.getElementById('top-category-stat').innerText = topCat;

            if (categoryChartInstance) categoryChartInstance.destroy();

            const ctxCat = canvasCategory.getContext('2d');
            categoryChartInstance = new Chart(ctxCat, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(catCount),
                    datasets: [{
                        data: Object.values(catCount),
                        backgroundColor: ['#18181b', '#FACC15', '#e4e4e7', '#9ca3af', '#71717a'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    cutout: '70%',
                    plugins: { 
                        legend: { position: 'bottom', labels: { usePointStyle: true, boxWidth: 8 } }
                    }
                }
            });
        }


        function loadAdminNotifications() {
            const list = document.getElementById('notifications-list');
            const countBadge = document.getElementById('stat-notifications');
            
            db.collection('notifications').orderBy('timestamp', 'desc').limit(20).onSnapshot(snap => {
                const unread = snap.docs.filter(d => !d.data().read).length;
                countBadge.textContent = snap.size; 
                
                if (snap.empty) {
                    list.innerHTML = '<p class="text-gray-400 text-sm">Nenhuma notificação.</p>';
                    return;
                }

                list.innerHTML = snap.docs.map(doc => {
                    const n = doc.data();
                    let icon, text;
                    if(n.type === 'like') {
                        icon = 'ph-heart text-purple-500';
                        text = 'Curtiu o post:';
                    } else if (n.type === 'comment') {
                        icon = 'ph-chat-circle-text text-brand-600';
                        text = 'Comentou em:';
                    } else {
                        icon = 'ph-bell text-gray-500';
                        text = 'Interagiu em:';
                    }
                    const time = formatDate(n.timestamp);
                    return `
                        <div class="p-4 bg-gray-50 hover:bg-gray-100 rounded-lg flex items-start gap-3 border border-gray-100 transition relative group">
                            <div class="bg-white p-2 rounded-full mt-1 border border-gray-100 shadow-sm"><i class="ph-fill ${icon}"></i></div>
                            <div class="flex-1 cursor-pointer" onclick="openArticle('${n.postId}')">
                                <div class="flex justify-between pr-8">
                                    <p class="text-sm text-gray-900 font-bold">${n.userName}</p>
                                    <span class="text-xs text-gray-400">${time}</span>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">${text} <span class="text-black font-medium">${n.postTitle}</span></p>
                            </div>
                            <button onclick="openDeleteModal(null, null, 'notification', '${doc.id}')" class="absolute top-4 right-4 text-gray-300 hover:text-red-500 transition" title="Excluir Notificação"><i class="ph-bold ph-trash"></i></button>
                        </div>
                    `;
                }).join('');
            });
        }

        // Updated Modal Logic
        function openDeleteModal(postId, commentId, type = 'comment', notifId = null) {
            deleteTarget = { postId, commentId, type, notifId };
            document.getElementById('delete-modal').classList.remove('hidden');
        }

        function closeDeleteModal() {
            document.getElementById('delete-modal').classList.add('hidden');
            deleteTarget = null;
        }

        document.getElementById('confirm-delete-btn').addEventListener('click', () => {
            if(!deleteTarget) return;

            if (deleteTarget.type === 'comment') {
                db.collection("posts").doc(deleteTarget.postId).collection("comments").doc(deleteTarget.commentId).delete()
                    .then(() => { showToast("Comentário excluído"); closeDeleteModal(); })
                    .catch(err => showToast("Erro: " + err.message, 'error'));
            } 
            else if (deleteTarget.type === 'post') {
                db.collection("posts").doc(deleteTarget.postId).delete()
                    .then(() => { 
                        showToast("Post excluído"); 
                        fetchBlogPosts(); 
                        closeDeleteModal(); 
                    })
                    .catch(err => showToast("Erro: " + err.message, 'error'));
            }
            else if (deleteTarget.type === 'notification') {
                db.collection('notifications').doc(deleteTarget.notifId).delete()
                    .then(() => { showToast("Notificação removida"); closeDeleteModal(); })
                    .catch(err => showToast("Erro: " + err.message, 'error'));
            }
        });

        // --- ADMIN FUNCTIONS ---
        function loadAdminPostsTable() {
            const tbody = document.getElementById('admin-posts-table-body');
            tbody.innerHTML = allBlogPosts.map(p => `
                <tr class="hover:bg-gray-50 transition border-b border-gray-50">
                    <td class="px-6 py-4 font-bold text-gray-800">${p.title}</td>
                    <td class="px-6 py-4"><span class="px-2 py-1 bg-gray-100 rounded text-xs text-gray-600 uppercase font-bold">${p.category}</span></td>
                    <td class="px-6 py-4 text-xs">${formatDate(p.createdAt)}</td>
                    <td class="px-6 py-4 text-center font-mono text-xs">${p.views || 0}</td>
                    <td class="px-6 py-4 text-right">
                        <button onclick="loadPostForEdit('${p.id}')" class="text-blue-600 hover:text-blue-800 font-bold text-xs mr-3">EDITAR</button>
                        <button onclick="openDeleteModal('${p.id}', null, 'post')" class="text-red-400 hover:text-red-600 font-bold text-xs">EXCLUIR</button>
                    </td>
                </tr>
            `).join('');
        }

        function filterAdminPosts() {
            const term = document.getElementById('admin-search-posts').value.toLowerCase();
            const tbody = document.getElementById('admin-posts-table-body');
            const filtered = allBlogPosts.filter(p => p.title.toLowerCase().includes(term));
            
            tbody.innerHTML = filtered.map(p => `
                 <tr class="hover:bg-gray-50 transition border-b border-gray-50">
                    <td class="px-6 py-4 font-bold text-gray-800">${p.title}</td>
                    <td class="px-6 py-4"><span class="px-2 py-1 bg-gray-100 rounded text-xs text-gray-600 uppercase font-bold">${p.category}</span></td>
                    <td class="px-6 py-4 text-xs">${formatDate(p.createdAt)}</td>
                    <td class="px-6 py-4 text-center font-mono text-xs">${p.views || 0}</td>
                    <td class="px-6 py-4 text-right">
                        <button onclick="loadPostForEdit('${p.id}')" class="text-blue-600 hover:text-blue-800 font-bold text-xs mr-3">EDITAR</button>
                        <button onclick="openDeleteModal('${p.id}', null, 'post')" class="text-red-400 hover:text-red-600 font-bold text-xs">EXCLUIR</button>
                    </td>
                </tr>
            `).join('');
        }

        function showPostEditor() {
            document.getElementById('posts-table-container').classList.add('hidden');
            document.getElementById('post-editor').classList.remove('hidden');
            resetAdminForm();
        }

        function hidePostEditor() {
            document.getElementById('posts-table-container').classList.remove('hidden');
            document.getElementById('post-editor').classList.add('hidden');
        }

        function resetAdminForm() {
            currentEditingId = null;
            document.getElementById('form-title').innerHTML = 'Novo Post';
            document.getElementById('admin-submit-btn').textContent = "Publicar Artigo";
            document.forms[1].reset(); 
            document.getElementById('admin-title').value = '';
            document.getElementById('admin-intro').value = '';
            document.getElementById('admin-image').value = '';
            document.getElementById('admin-content-rich').innerHTML = '';
            document.getElementById('admin-author').value = 'Redação CrediFácil';
        }

        function loadPostForEdit(id) {
            const post = allBlogPosts.find(p => p.id === id);
            if(!post) return;
            showPostEditor();
            currentEditingId = id;
            document.getElementById('form-title').innerHTML = 'Editando: ' + post.title;
            document.getElementById('admin-submit-btn').textContent = "Salvar Alterações";
            document.getElementById('admin-title').value = post.title;
            document.getElementById('admin-category').value = post.category;
            document.getElementById('admin-author').value = post.author;
            document.getElementById('admin-image').value = post.image;
            document.getElementById('admin-intro').value = post.intro;
            document.getElementById('admin-content-rich').innerHTML = post.content;
        }

        function savePost(e) {
            e.preventDefault();
            if(!db) return;
            const btn = document.getElementById('admin-submit-btn');
            btn.disabled = true;
            btn.textContent = "Salvando...";
            const postData = {
                title: document.getElementById('admin-title').value,
                category: document.getElementById('admin-category').value,
                author: document.getElementById('admin-author').value,
                image: document.getElementById('admin-image').value,
                intro: document.getElementById('admin-intro').value,
                content: document.getElementById('admin-content-rich').innerHTML,
            };
            let promise;
            if (currentEditingId) {
                promise = db.collection("posts").doc(currentEditingId).update(postData);
            } else {
                postData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                postData.likes = 0;
                postData.views = 0; 
                promise = db.collection("posts").add(postData);
            }
            promise.then(() => {
                showToast(currentEditingId ? "Post atualizado!" : "Post criado!");
                fetchBlogPosts();
                hidePostEditor();
                btn.disabled = false;
            }).catch(err => {
                showToast("Erro: " + err.message, 'error');
                btn.disabled = false;
            });
        }

        // --- SHARED & UTILS ---
        function sharePost(network) {
            const url = encodeURIComponent(window.location.href);
            const text = encodeURIComponent(`Confira este artigo: ${window.currentPostTitle}`);
            let shareUrl = '';
            if(network === 'whatsapp') shareUrl = `https://api.whatsapp.com/send?text=${text} ${url}`;
            else if(network === 'facebook') shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
            else if(network === 'twitter') shareUrl = `https://twitter.com/intent/tweet?text=${text}&url=${url}`;
            window.open(shareUrl, '_blank', 'width=600,height=400');
        }

        function formatDoc(cmd, value = null) {
            document.execCommand(cmd, false, value);
            document.getElementById('admin-content-rich').focus();
        }
        function addLink() {
            const url = prompt("Insira a URL do link:");
            if(url) document.execCommand("createLink", false, url);
        }
        function insertImage() {
            const url = prompt("Insira a URL da imagem:");
            if(url) document.execCommand("insertImage", false, url);
        }

        function updateLiveCalculation() {
            const v = document.getElementById('loan-amount').value;
            const t = document.getElementById('loan-term').value;
            if(v > 0) {
                const rate = 0.035; 
                const installment = (v * rate) / (1 - Math.pow(1 + rate, -t));
                document.getElementById('live-installment').textContent = installment.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
                document.getElementById('live-preview').classList.remove('hidden');
            }
        }

        function calculateFinalLoan(e) {
            e.preventDefault();
            const container = document.getElementById('loan-recommendations-container');
            const resultDiv = document.getElementById('loan-result');
            const shuffled = [...loanPartners].sort(() => 0.5 - Math.random()).slice(0, 3);
            
            container.innerHTML = shuffled.map(p => `
                <div onclick="openOffer('${p.name}', '${p.url}')" class="flex justify-between items-center p-4 bg-white border border-gray-200 rounded-xl hover:border-brand-400 hover:shadow-md cursor-pointer transition group">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center font-bold text-gray-700">${p.name[0]}</div>
                        <span class="font-bold text-gray-800 text-lg">${p.name}</span>
                    </div>
                    <span class="text-sm bg-brand-50 text-brand-700 font-bold px-3 py-1 rounded-lg group-hover:bg-brand-400 group-hover:text-black transition flex items-center gap-1">
                        Ver Oferta <i class="ph-bold ph-arrow-right"></i>
                    </span>
                </div>
            `).join('');
            resultDiv.classList.remove('hidden');
            resultDiv.scrollIntoView({behavior: 'smooth'});

            // Save to History (Novidade 2)
            const v = document.getElementById('loan-amount').value;
            const t = document.getElementById('loan-term').value;
            const installmentValue = document.getElementById('live-installment').textContent.replace('R$', '').trim();
            saveToHistory(v, t, installmentValue);
        }

        function openOffer(partnerName, url) {
            const amount = parseFloat(document.getElementById('loan-amount').value) || 5000;
            const months = parseInt(document.getElementById('loan-term').value) || 12;
            const rate = 0.035;
            const pmt = (amount * rate) / (1 - Math.pow(1 + rate, -months));
            document.getElementById('offer-partner-name').textContent = partnerName;
            document.getElementById('offer-value').textContent = amount.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
            document.getElementById('offer-installments').textContent = `${months}x ${pmt.toLocaleString('pt-BR', {style:'currency', currency:'BRL'})}`;
            const btn = document.getElementById('offer-cta-btn');
            btn.onclick = () => window.open(url, '_blank');
            navigateToHash('offer-screen');
        }

        function filterCards(category) { renderCards(category); }

        function renderCards(filter) {
            const container = document.getElementById('cards-container');
            if(!container) return;
            document.querySelectorAll('.filter-btn').forEach(b => {
                b.className = "filter-btn px-6 py-3 bg-white border border-gray-200 text-gray-600 hover:border-brand-400 hover:text-black rounded-xl text-sm font-bold transition shadow-sm hover:shadow-md";
            });
            const activeBtn = document.getElementById(`btn-${filter}`);
            if(activeBtn) activeBtn.className = "filter-btn active px-6 py-3 bg-black text-white rounded-xl text-sm font-bold transition shadow-lg transform hover:-translate-y-0.5";
            const filtered = (filter === 'todos') ? cardsData : cardsData.filter(c => c.categories.includes(filter));
            container.innerHTML = filtered.map(card => {
                const annuityTag = card.annuity.includes('Grátis') || card.annuity === 'R$ 0,00' 
                    ? `<div class="absolute top-4 right-4 text-[10px] font-extrabold bg-green-100 text-green-700 border border-green-200 px-3 py-1 rounded-full uppercase tracking-wider shadow-sm">Zero Anuidade</div>`
                    : `<div class="absolute top-4 right-4 text-[10px] font-extrabold bg-orange-100 text-orange-700 border border-orange-200 px-3 py-1 rounded-full uppercase tracking-wider shadow-sm">Com Anuidade</div>`;
                return `
                <div class="bg-white rounded-3xl shadow-sm hover:shadow-xl transition-all duration-300 border border-gray-100 flex flex-col group overflow-hidden relative">
                    <div class="p-8 flex flex-col items-center bg-gradient-to-b from-gray-50 to-white relative">
                        ${annuityTag}
                        <div class="w-full h-44 ${card.bgClass} rounded-2xl mb-6 shadow-xl relative flex items-center justify-center text-white overflow-hidden transform group-hover:scale-105 transition duration-500">
                            <span class="font-bold text-2xl relative z-10 tracking-widest drop-shadow-md">${card.name}</span>
                            ${card.isInter ? '' : `<div class="absolute inset-0 ${card.iconBg} opacity-30 transform ${card.rotation} translate-y-12 scale-150"></div>`}
                        </div>
                        <h3 class="text-xl font-bold text-black mb-3">${card.name}</h3>
                        <div class="flex flex-wrap justify-center gap-2">${card.badges.map(b => `<span class="text-[10px] font-bold uppercase tracking-wide ${b.color} px-2 py-1 rounded-md">${b.text}</span>`).join('')}</div>
                    </div>
                    <div class="px-8 py-6 space-y-4 flex-1 bg-white">
                        <p class="text-sm text-gray-600 text-center leading-relaxed">${card.desc}</p>
                        <div class="bg-gray-50 p-4 rounded-xl flex justify-between items-center text-sm border border-gray-100">
                            <span class="text-gray-500">Renda Mínima</span>
                            <span class="font-bold text-black">${card.income}</span>
                        </div>
                    </div>
                    <div class="p-8 pt-0 mt-auto">
                        <a href="${card.link}" target="_blank" class="block w-full text-center bg-black hover:bg-brand-500 hover:text-black text-white font-bold py-4 rounded-xl transition shadow-lg flex items-center justify-center gap-2">Solicitar Agora <i class="ph-bold ph-arrow-up-right"></i></a>
                    </div>
                </div>
            `}).join('');
        }

        function toggleMobileMenu() { document.getElementById('mobile-menu').classList.toggle('hidden'); }
        function handleLogin(e) {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            const err = document.getElementById('login-error');
            btn.textContent = "Verificando...";
            btn.disabled = true;
            auth.signInWithEmailAndPassword(document.getElementById('login-email').value, document.getElementById('login-password').value)
                .catch(error => {
                    err.textContent = "Erro: " + error.message;
                    err.classList.remove('hidden');
                    btn.textContent = "Entrar no Painel";
                    btn.disabled = false;
                });
        }
        function handleLogout() { auth.signOut(); }

        function toggleLike() {
            const id = window.location.hash.includes('artigo-') ? allBlogPosts.find(p => p.title === document.getElementById('post-title').textContent)?.id : null;
            if(!id) return;
             const isLiked = localStorage.getItem(`liked_${id}`);
             const ref = db.collection("posts").doc(id);
             if(isLiked) {
                 localStorage.removeItem(`liked_${id}`);
                 ref.update({ likes: firebase.firestore.FieldValue.increment(-1) });
                 document.getElementById('like-icon').classList.remove('text-brand-500', 'ph-fill');
                 document.getElementById('like-icon').classList.add('text-gray-300', 'ph-bold');
             } else {
                 localStorage.setItem(`liked_${id}`, 'true');
                 ref.update({ likes: firebase.firestore.FieldValue.increment(1) });
                 document.getElementById('like-icon').classList.add('text-brand-500', 'ph-fill');
                 document.getElementById('like-icon').classList.remove('text-gray-300', 'ph-bold');
             }
             document.getElementById('like-icon').classList.add('animate-pulse-custom');
             setTimeout(() => document.getElementById('like-icon').classList.remove('animate-pulse-custom'), 500);
        }

        function toggleReplyForm(commentId) { document.getElementById(`reply-form-${commentId}`).classList.toggle('hidden'); }

        function submitComment(e) {
            e.preventDefault();
            const id = allBlogPosts.find(p => p.title === document.getElementById('post-title').textContent)?.id;
            const postTitle = document.getElementById('post-title').textContent; 
            
            if(!id) return;
            const n = document.getElementById('comment-name');
            const t = document.getElementById('comment-text');
            
            db.collection("posts").doc(id).collection("comments").add({
                name: n.value, 
                text: t.value, 
                replies: [],
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => {
                showToast("Comentário enviado!");
                return db.collection("notifications").add({
                    type: 'comment',
                    postId: id,
                    postTitle: postTitle,
                    userName: n.value,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    read: false
                });
            })
            .then(() => { n.value=''; t.value=''; });
        }

        function submitReply(e, postId, commentId) {
            e.preventDefault();
            const input = document.getElementById(`reply-input-${commentId}`);
            const text = input.value;
            const currentUser = auth.currentUser;
            const name = currentUser ? "Admin CrediFácil" : "Usuário";
            const postTitle = document.getElementById('post-title').textContent;

            db.collection("posts").doc(postId).collection("comments").doc(commentId).update({
                replies: firebase.firestore.FieldValue.arrayUnion({
                    name: name,
                    text: text,
                    isAdmin: !!currentUser,
                    timestamp: new Date()
                })
            })
            .then(() => {
                showToast("Resposta enviada!");
                if(!currentUser) {
                    db.collection("notifications").add({
                        type: 'reply',
                        postId: postId,
                        postTitle: postTitle,
                        userName: name,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                        read: false
                    });
                }
                input.value = '';
                document.getElementById(`reply-form-${commentId}`).classList.add('hidden');
            });
        }
        
        // --- MISSING LOADCOMMENTS RESTORED ---
        function loadComments(id) {
            const list = document.getElementById('comments-list');
            const count = document.getElementById('comment-count');
            const currentUser = auth.currentUser;

            db.collection("posts").doc(id).collection("comments").orderBy("timestamp", "desc").onSnapshot(snap => {
                count.textContent = snap.size;
                if(snap.empty) { list.innerHTML = '<p class="text-gray-400 text-sm italic">Nenhum comentário ainda.</p>'; return; }
                
                list.innerHTML = '';
                snap.forEach(d => {
                    const c = d.data();
                    const replies = c.replies || [];
                    const deleteBtn = currentUser ? 
                        `<button onclick="openDeleteModal('${id}', '${d.id}', 'comment')" class="text-red-400 hover:text-red-600 ml-2" title="Excluir Comentário"><i class="ph-bold ph-trash"></i></button>` : '';
                    
                    let repliesHtml = '';
                    if(replies.length > 0) {
                        repliesHtml = replies.map(r => `
                            <div class="ml-8 mt-2 pl-4 border-l-2 border-brand-200">
                                <div class="flex justify-between items-center text-xs">
                                    <span class="font-bold ${r.isAdmin ? 'text-brand-600' : 'text-gray-800'}">${r.name} ${r.isAdmin ? '<span class="bg-brand-100 text-brand-700 px-1 rounded ml-1 text-[10px]">Admin</span>' : ''}</span>
                                    <span class="text-gray-400">Resposta</span>
                                </div>
                                <p class="text-sm text-gray-700 mt-1">${r.text}</p>
                            </div>
                        `).join('');
                    }

                    list.innerHTML += `
                        <div class="bg-gray-50 p-4 rounded-xl border border-gray-100 mb-3 relative group">
                            <div class="flex justify-between mb-1">
                                <span class="font-bold text-sm text-gray-900">${c.name}</span>
                                <div class="flex items-center text-xs text-gray-400 gap-2">
                                    <span>Recente</span>
                                    ${deleteBtn}
                                </div>
                            </div>
                            <p class="text-sm text-gray-700 leading-relaxed">${c.text}</p>
                            ${repliesHtml}
                            <div class="mt-3 pt-2 border-t border-gray-100">
                                <button onclick="toggleReplyForm('${d.id}')" class="text-xs font-bold text-gray-500 hover:text-brand-600 flex items-center gap-1 transition">
                                    <i class="ph-bold ph-arrow-bend-down-right"></i> Responder
                                </button>
                                <form id="reply-form-${d.id}" onsubmit="submitReply(event, '${id}', '${d.id}')" class="hidden mt-2 flex gap-2">
                                    <input type="text" id="reply-input-${d.id}" placeholder="Escreva uma resposta..." class="flex-1 text-xs px-3 py-2 border rounded-lg outline-none focus:border-brand-400" required>
                                    <button type="submit" class="bg-brand-400 text-black text-xs font-bold px-3 py-2 rounded-lg hover:bg-brand-500 transition">Enviar</button>
                                </form>
                            </div>
                        </div>
                    `;
                });
            });
        }
    </script>
</body>
</html>
